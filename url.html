<!DOCTYPE html><html lang=en><meta charset=utf-8>
  <title>URL Standard</title>
  <link href=https://www.whatwg.org/style/specification rel=stylesheet>
  <link href=https://resources.whatwg.org/logo-url.svg rel=icon>
<script async src=//resources.whatwg.org/file-bug.js></script>
  <style>
  .grammar-rule {
    color: black;
    background-color: hsl(120, 100%, 90%);
    font-weight: bold;
    padding: 2px;
    border: 2px solid black;
  }
</style>


<style>svg.railroad-diagram{background-color:hsl(30,20%,95%);}svg.railroad-diagram path{stroke-width:3;stroke:black;fill:rgba(0,0,0,0);}svg.railroad-diagram text{font:bold 14px monospace;text-anchor:middle;}svg.railroad-diagram text.label{text-anchor:start;}svg.railroad-diagram text.comment{font:italic 12px monospace;}svg.railroad-diagram rect{stroke-width:3;stroke:black;fill:hsl(120,100%,90%);}</style><style>svg.railroad-diagram{background-color:hsl(30,20%,95%);}svg.railroad-diagram path{stroke-width:3;stroke:black;fill:rgba(0,0,0,0);}svg.railroad-diagram text{font:bold 14px monospace;text-anchor:middle;}svg.railroad-diagram text.label{text-anchor:start;}svg.railroad-diagram text.comment{font:italic 12px monospace;}svg.railroad-diagram rect{stroke-width:3;stroke:black;fill:hsl(120,100%,90%);}</style><style>svg.railroad-diagram{background-color:hsl(30,20%,95%);}svg.railroad-diagram path{stroke-width:3;stroke:black;fill:rgba(0,0,0,0);}svg.railroad-diagram text{font:bold 14px monospace;text-anchor:middle;}svg.railroad-diagram text.label{text-anchor:start;}svg.railroad-diagram text.comment{font:italic 12px monospace;}svg.railroad-diagram rect{stroke-width:3;stroke:black;fill:hsl(120,100%,90%);}</style><style>svg.railroad-diagram{background-color:hsl(30,20%,95%);}svg.railroad-diagram path{stroke-width:3;stroke:black;fill:rgba(0,0,0,0);}svg.railroad-diagram text{font:bold 14px monospace;text-anchor:middle;}svg.railroad-diagram text.label{text-anchor:start;}svg.railroad-diagram text.comment{font:italic 12px monospace;}svg.railroad-diagram rect{stroke-width:3;stroke:black;fill:hsl(120,100%,90%);}</style><style>svg.railroad-diagram{background-color:hsl(30,20%,95%);}svg.railroad-diagram path{stroke-width:3;stroke:black;fill:rgba(0,0,0,0);}svg.railroad-diagram text{font:bold 14px monospace;text-anchor:middle;}svg.railroad-diagram text.label{text-anchor:start;}svg.railroad-diagram text.comment{font:italic 12px monospace;}svg.railroad-diagram rect{stroke-width:3;stroke:black;fill:hsl(120,100%,90%);}</style><style>svg.railroad-diagram{background-color:hsl(30,20%,95%);}svg.railroad-diagram path{stroke-width:3;stroke:black;fill:rgba(0,0,0,0);}svg.railroad-diagram text{font:bold 14px monospace;text-anchor:middle;}svg.railroad-diagram text.label{text-anchor:start;}svg.railroad-diagram text.comment{font:italic 12px monospace;}svg.railroad-diagram rect{stroke-width:3;stroke:black;fill:hsl(120,100%,90%);}</style><style>svg.railroad-diagram{background-color:hsl(30,20%,95%);}svg.railroad-diagram path{stroke-width:3;stroke:black;fill:rgba(0,0,0,0);}svg.railroad-diagram text{font:bold 14px monospace;text-anchor:middle;}svg.railroad-diagram text.label{text-anchor:start;}svg.railroad-diagram text.comment{font:italic 12px monospace;}svg.railroad-diagram rect{stroke-width:3;stroke:black;fill:hsl(120,100%,90%);}</style><style>svg.railroad-diagram{background-color:hsl(30,20%,95%);}svg.railroad-diagram path{stroke-width:3;stroke:black;fill:rgba(0,0,0,0);}svg.railroad-diagram text{font:bold 14px monospace;text-anchor:middle;}svg.railroad-diagram text.label{text-anchor:start;}svg.railroad-diagram text.comment{font:italic 12px monospace;}svg.railroad-diagram rect{stroke-width:3;stroke:black;fill:hsl(120,100%,90%);}</style><style>svg.railroad-diagram{background-color:hsl(30,20%,95%);}svg.railroad-diagram path{stroke-width:3;stroke:black;fill:rgba(0,0,0,0);}svg.railroad-diagram text{font:bold 14px monospace;text-anchor:middle;}svg.railroad-diagram text.label{text-anchor:start;}svg.railroad-diagram text.comment{font:italic 12px monospace;}svg.railroad-diagram rect{stroke-width:3;stroke:black;fill:hsl(120,100%,90%);}</style><style>svg.railroad-diagram{background-color:hsl(30,20%,95%);}svg.railroad-diagram path{stroke-width:3;stroke:black;fill:rgba(0,0,0,0);}svg.railroad-diagram text{font:bold 14px monospace;text-anchor:middle;}svg.railroad-diagram text.label{text-anchor:start;}svg.railroad-diagram text.comment{font:italic 12px monospace;}svg.railroad-diagram rect{stroke-width:3;stroke:black;fill:hsl(120,100%,90%);}</style><style>svg.railroad-diagram{background-color:hsl(30,20%,95%);}svg.railroad-diagram path{stroke-width:3;stroke:black;fill:rgba(0,0,0,0);}svg.railroad-diagram text{font:bold 14px monospace;text-anchor:middle;}svg.railroad-diagram text.label{text-anchor:start;}svg.railroad-diagram text.comment{font:italic 12px monospace;}svg.railroad-diagram rect{stroke-width:3;stroke:black;fill:hsl(120,100%,90%);}</style><style>svg.railroad-diagram{background-color:hsl(30,20%,95%);}svg.railroad-diagram path{stroke-width:3;stroke:black;fill:rgba(0,0,0,0);}svg.railroad-diagram text{font:bold 14px monospace;text-anchor:middle;}svg.railroad-diagram text.label{text-anchor:start;}svg.railroad-diagram text.comment{font:italic 12px monospace;}svg.railroad-diagram rect{stroke-width:3;stroke:black;fill:hsl(120,100%,90%);}</style><style>svg.railroad-diagram{background-color:hsl(30,20%,95%);}svg.railroad-diagram path{stroke-width:3;stroke:black;fill:rgba(0,0,0,0);}svg.railroad-diagram text{font:bold 14px monospace;text-anchor:middle;}svg.railroad-diagram text.label{text-anchor:start;}svg.railroad-diagram text.comment{font:italic 12px monospace;}svg.railroad-diagram rect{stroke-width:3;stroke:black;fill:hsl(120,100%,90%);}</style><style>svg.railroad-diagram{background-color:hsl(30,20%,95%);}svg.railroad-diagram path{stroke-width:3;stroke:black;fill:rgba(0,0,0,0);}svg.railroad-diagram text{font:bold 14px monospace;text-anchor:middle;}svg.railroad-diagram text.label{text-anchor:start;}svg.railroad-diagram text.comment{font:italic 12px monospace;}svg.railroad-diagram rect{stroke-width:3;stroke:black;fill:hsl(120,100%,90%);}</style><style>svg.railroad-diagram{background-color:hsl(30,20%,95%);}svg.railroad-diagram path{stroke-width:3;stroke:black;fill:rgba(0,0,0,0);}svg.railroad-diagram text{font:bold 14px monospace;text-anchor:middle;}svg.railroad-diagram text.label{text-anchor:start;}svg.railroad-diagram text.comment{font:italic 12px monospace;}svg.railroad-diagram rect{stroke-width:3;stroke:black;fill:hsl(120,100%,90%);}</style><style>svg.railroad-diagram{background-color:hsl(30,20%,95%);}svg.railroad-diagram path{stroke-width:3;stroke:black;fill:rgba(0,0,0,0);}svg.railroad-diagram text{font:bold 14px monospace;text-anchor:middle;}svg.railroad-diagram text.label{text-anchor:start;}svg.railroad-diagram text.comment{font:italic 12px monospace;}svg.railroad-diagram rect{stroke-width:3;stroke:black;fill:hsl(120,100%,90%);}</style><style>svg.railroad-diagram{background-color:hsl(30,20%,95%);}svg.railroad-diagram path{stroke-width:3;stroke:black;fill:rgba(0,0,0,0);}svg.railroad-diagram text{font:bold 14px monospace;text-anchor:middle;}svg.railroad-diagram text.label{text-anchor:start;}svg.railroad-diagram text.comment{font:italic 12px monospace;}svg.railroad-diagram rect{stroke-width:3;stroke:black;fill:hsl(120,100%,90%);}</style><style>svg.railroad-diagram{background-color:hsl(30,20%,95%);}svg.railroad-diagram path{stroke-width:3;stroke:black;fill:rgba(0,0,0,0);}svg.railroad-diagram text{font:bold 14px monospace;text-anchor:middle;}svg.railroad-diagram text.label{text-anchor:start;}svg.railroad-diagram text.comment{font:italic 12px monospace;}svg.railroad-diagram rect{stroke-width:3;stroke:black;fill:hsl(120,100%,90%);}</style><style>svg.railroad-diagram{background-color:hsl(30,20%,95%);}svg.railroad-diagram path{stroke-width:3;stroke:black;fill:rgba(0,0,0,0);}svg.railroad-diagram text{font:bold 14px monospace;text-anchor:middle;}svg.railroad-diagram text.label{text-anchor:start;}svg.railroad-diagram text.comment{font:italic 12px monospace;}svg.railroad-diagram rect{stroke-width:3;stroke:black;fill:hsl(120,100%,90%);}</style><style>svg.railroad-diagram{background-color:hsl(30,20%,95%);}svg.railroad-diagram path{stroke-width:3;stroke:black;fill:rgba(0,0,0,0);}svg.railroad-diagram text{font:bold 14px monospace;text-anchor:middle;}svg.railroad-diagram text.label{text-anchor:start;}svg.railroad-diagram text.comment{font:italic 12px monospace;}svg.railroad-diagram rect{stroke-width:3;stroke:black;fill:hsl(120,100%,90%);}</style><style>svg.railroad-diagram{background-color:hsl(30,20%,95%);}svg.railroad-diagram path{stroke-width:3;stroke:black;fill:rgba(0,0,0,0);}svg.railroad-diagram text{font:bold 14px monospace;text-anchor:middle;}svg.railroad-diagram text.label{text-anchor:start;}svg.railroad-diagram text.comment{font:italic 12px monospace;}svg.railroad-diagram rect{stroke-width:3;stroke:black;fill:hsl(120,100%,90%);}</style><body class=h-entry>
<div class=head>
  <p data-fill-with=logo><a class=logo href=http://www.whatwg.org/>
    <img alt=WHATWG height=100 src=https://resources.whatwg.org/logo-url.svg>
</a>
</p>
  <h1 class="p-name no-ref" id=title>URL</h1>
  <h2 class="no-num no-toc no-ref heading settled" id=subtitle><span class=content>Living Standard,
    <span class=dt-updated><span class=value-title title=20141030>30 October 2014</span></span></span></h2>
  <div data-fill-with=spec-metadata><dl><dt>Editor:<dd><div class="p-author h-card vcard"><a class="p-name fn u-url url" href=http://intertwingly.net/blog/>Sam Ruby</a> (<a class="p-org org" href=https://www.ibm.com/>IBM</a>) <a class="u-email email" href=mailto:rubys@intertwingly.net>rubys@intertwingly.net</a></div><dt>Version History:<dd><span><a href=https://github.com/rubys/url/commits/peg.js>https://github.com/rubys/url/commits/peg.js</a></span><dt>Participate:<dd><span><a href=mailto:public-webapps@w3.org>public-webapps@w3.org</a> (<a href=http://lists.w3.org/Archives/Public/public-webapps/>archives</a>)</span><dd><span><a href=https://whatwg.org/mailing-list>whatwg@whatwg.org</a> (<a href=https://whatwg.org/mailing-list#specs>archives</a>)</span><dd><span><a href=http://wiki.whatwg.org/wiki/IRC>IRC: #whatwg on Freenode</a></span></dl></div>
  <div data-fill-with=warning></div>
  <p class=copyright data-fill-with=copyright><a href=http://creativecommons.org/publicdomain/zero/1.0/ rel=license><img alt=CC0 src=https://i.creativecommons.org/p/zero/1.0/80x15.png></a>
To the extent possible under law, the editors have waived all copyright
and related or neighboring rights to this work.
In addition, as of 30 October 2014,
the editors have made this specification available under the
<a href=http://www.openwebfoundation.org/legal/the-owf-1-0-agreements/owfa-1-0 rel=license>Open Web Foundation Agreement Version 1.0</a>,
which is available at http://www.openwebfoundation.org/legal/the-owf-1-0-agreements/owfa-1-0.
Parts of this work may be from another specification document.  If so, those parts are instead covered by the license of that specification document.
</p>
  <hr title="Separator for header">
</div>

<h2 class="no-num no-toc no-ref heading settled" id=abstract><span class=content>Abstract</span></h2>
<div class=p-summary data-fill-with=abstract><p>This specification <a href=http://agiledictionary.com/209/spike/>spike</a> defines parsing rules for URLs</p>

</div>
<div data-fill-with=at-risk></div>

<h2 class="no-num no-toc no-ref heading settled" id=contents><span class=content>Table of Contents</span></h2>
<div data-fill-with=table-of-contents><ul class=toc><li><a href=#goals><span class=secno>1</span> <span class=content>Goals</span></a><li><a href=#todos><span class=secno>2</span> <span class=content>Todos</span></a><li><a href=#parsing-rules><span class=secno>3</span> <span class=content>Parsing Rules</span></a><ul class=toc><li><a href=#url><span class=secno>3.1</span> <span class=content>url</span></a><li><a href=#file-like-relative-url><span class=secno>3.2</span> <span class=content>file-like-relative-url</span></a><li><a href=#file-like-relative-scheme><span class=secno>3.3</span> <span class=content>file-like-relative-scheme</span></a><li><a href=#absolute-url><span class=secno>3.4</span> <span class=content>absolute-url</span></a><li><a href=#relative-url><span class=secno>3.5</span> <span class=content>relative-url</span></a><li><a href=#non-relative-url><span class=secno>3.6</span> <span class=content>non-relative-url</span></a><li><a href=#relative-scheme><span class=secno>3.7</span> <span class=content>relative-scheme</span></a><li><a href=#scheme><span class=secno>3.8</span> <span class=content>scheme</span></a><li><a href=#user-info><span class=secno>3.9</span> <span class=content>user-info</span></a><li><a href=#user><span class=secno>3.10</span> <span class=content>user</span></a><li><a href=#password><span class=secno>3.11</span> <span class=content>password</span></a><li><a href=#host><span class=secno>3.12</span> <span class=content>host</span></a><li><a href=#ipv6addr><span class=secno>3.13</span> <span class=content>ipv6addr</span></a><li><a href=#h16><span class=secno>3.14</span> <span class=content>h16</span></a><li><a href=#ls32><span class=secno>3.15</span> <span class=content>ls32</span></a><li><a href=#decimal_byte><span class=secno>3.16</span> <span class=content>decimal_byte</span></a><li><a href=#port><span class=secno>3.17</span> <span class=content>port</span></a><li><a href=#path><span class=secno>3.18</span> <span class=content>path</span></a><li><a href=#data><span class=secno>3.19</span> <span class=content>data</span></a><li><a href=#query><span class=secno>3.20</span> <span class=content>query</span></a><li><a href=#fragment><span class=secno>3.21</span> <span class=content>fragment</span></a></ul><li><a href=#common-functions><span class=secno>4</span> <span class=content>Common Functions</span></a><li><a href=#conformance><span class=secno></span> <span class=content>Conformance</span></a><li><a href=#references><span class=secno></span> <span class=content>References</span></a><ul class=toc><li><a href=#normative><span class=secno></span> <span class=content>Normative References</span></a><li><a href=#informative><span class=secno></span> <span class=content>Informative References</span></a></ul><li><a href=#index><span class=secno></span> <span class=content>Index</span></a></ul></div>

<h2 class="heading settled" data-level=1 id=goals><span class=secno>1. </span><span class=content>Goals</span><a class=self-link href=#goals></a></h2>

<ul><li data-md=""><p>Resolve
<a href="https://www.w3.org/Bugs/Public/show_bug.cgi?id=25946">bug
25946</a> by merging this specification with the <a href=https://url.spec.whatwg.org/>URL Living Standard</a>.  Once a new
baseline has been established, evolve the standard towards greater web
compatibility, greater interoperability, and simpler algorithms, in that
order.</p>
<li data-md=""><p>Provide a
<a href=https://github.com/rubys/url/tree/peg.js/reference-implementation>reference
implementation</a>, where parts of this specification and parts of that
reference implementation are generated from a
<a href=https://github.com/rubys/url/blob/peg.js/url.pegjs>common
source</a>.  Included in the reference implementation is a
<a href=http://intertwingly.net/projects/pegurl/liveview.html>Live DOM URL
Viewer</a>.</p>
<li data-md=""><p>Integrate with <a href=https://travis-ci.org/>Travis</a> and activate the
<a href=http://docs.travis-ci.com/user/getting-started/#Step-two%3A-Activate-GitHub-Webhook>GitHub
WebHook</a> so that proposed changes are verified to build correctly and
pass the relevant tests.</p>
<li data-md=""><p>Evaluate
<a href=https://tools.ietf.org/html/draft-ietf-appsawg-uri-scheme-reg-04>draft-thaler-appsawg-uri-scheme-reg</a>
for the scheme registration mechanism in the
<a href=https://url.spec.whatwg.org/#url-writing>URL writing</a> section.</p>
<li data-md=""><p>Explore the idea of obsoleting <em>only</em> <a data-biblio-type=informative data-link-type=biblio href=#biblio-rfc3987 title=rfc3987>[rfc3987]</a> and not
<a data-biblio-type=informative data-link-type=biblio href=#biblio-rfc3986 title=rfc3986>[rfc3986]</a> too.  Consider explicitly adopt the following constraints on the
  canonicalized output of URL parsing:</p>
<ul><li data-md=""><p>URL parsing of canonicalized outputs roundtrip (i.e., this the
URL parser is an identity transform for such inputs).</p>
<li data-md=""><p>All canonicalized output are valid URIs (and, if necessary, submit
errata and/or identify specific
<a href=https://html.spec.whatwg.org/multipage/introduction.html#compliance-with-other-specifications>willful violations</a>).</p>
</ul><li data-md=""><p>Incorporate the substance of the
<a href=http://www.w3.org/TR/html5/references.html#refsURL>informative
note</a> that precedes the [URL] normative reference in the
<a href=http://www.w3.org/TR/html5/>HTML5 Recommendation</a> into a
status section or equivalent in this document.</p>
<li data-md=""><p>Define more soft <a data-link-type=dfn href=#parse-errors title="parse errors">parse errors</a>.  The
<a href=https://url.spec.whatwg.org/>URL living standard</a> has a start,
but based on <a href=http://intertwingly.net/projects/pegurl/urltest-results/>test
results</a>, there clearly needs to be more.</p>
</ul>
<h2 class="heading settled" data-level=2 id=todos><span class=secno>2. </span><span class=content>Todos</span><a class=self-link href=#todos></a></h2>

<p>These are items that should be done before the proposed merge:</p>

<ul><li data-md=""><p>Make it more clear what is normative; to be honest, I’m confused on this
point as the only real normative requirement for the parts defined by this
spec-let is "produce the same output as the algorithm defined herein".</p>
<li data-md=""><p>Implement <a href=https://url.spec.whatwg.org/#urlutils-and-urlutilsreadonly-members>Url
property getters and setters</a>.</p>
<li data-md=""><p>Implement <a href=https://url.spec.whatwg.org/#concept-basic-url-parser>Encoding
Override</a>.</p>
<li data-md=""><p>Reconcile the <a data-section="" href=#host>§3.12 host</a> parsing rules with the Encoding Living Standard
<a data-biblio-type=normative data-link-type=biblio href=#biblio-encoding title=encoding>[encoding]</a> and <a href=https://url.spec.whatwg.org/#idna>IDNA</a>.</p>
</ul>
<h2 class="heading settled" data-level=3 id=parsing-rules><span class=secno>3. </span><span class=content>Parsing Rules</span><a class=self-link href=#parsing-rules></a></h2>

<p>These railroad diagrams, as modified by the accompanying text, define grammar
production rules for URLs.  They are to be evaluated sequentially, first
left-to-right then top-to-bottom, backtracking as necessary, until a complete
match against the input provided is found.</p>

<p>Each rule can be invoked individually.  Rules can also invoke one another.
Rules when evaluated return a JSON objection, typically either a string or an
object where all of the values are strings.  The one exception is path values,
which are arrays of strings.</p>

<p>Two types of <dfn data-dfn-type=dfn data-noexport="" id=parse-errors>parse errors<a class=self-link href=#parse-errors></a></dfn> are defined.  Hard errors (indicated in
the spec with the following text: <em>terminate processing with a parse
error</em>) are mandatory.  Soft errors (all other errors) are optional.  User
agents are encouraged to expose <a href=https://url.spec.whatwg.org/#parse-error>parse errors</a> somehow.</p>

<p class=note>Note: the following subsections are intended to replace steps 5-8 in the
<a href=https://url.spec.whatwg.org/#concept-basic-url-parser>basic url parser</a>.  It also works out better if step 3 were to default <var>base</var> to a
non-null value, ideally one with a non-relative scheme, for example:
<code>{'scheme': 'about'}</code>.</p>

<h3 class="heading settled" data-level=3.1 id=url><span class=secno>3.1. </span><span class=content>url</span><a class=self-link href=#url></a></h3>

<div class=railroad><svg class=railroad-diagram height=152 viewBox="0 0 317 152" width=317>
<g transform="translate(.5 .5)">
<path d="M 20 21 v 20 m 10 -20 v 20 m -10 -10 h 20.5">
</path><g>
<path d="M40 31h0.0">
</path><path d="M276.0 31h0.0">
</path><path d="M40.0 31h20">
</path><g>
<path d="M60.0 31h0.0">
</path><path d="M256.0 31h0.0">
</path><rect height=22 width=196 x=60.0 y=20>
</rect><text x=158.0 y=35>
file-like-relative-url</text></g><path d="M256.0 31h20">
</path><path d="M40.0 31a10 10 0 0 1 10 10v10a10 10 0 0 0 10 10">
</path><g>
<path d="M60.0 61h40.0">
</path><path d="M216.0 61h40.0">
</path><rect height=22 width=116 x=100.0 y=50>
</rect><text x=158.0 y=65>
absolute-url</text></g><path d="M256.0 61a10 10 0 0 0 10 -10v-10a10 10 0 0 1 10 -10">
</path><path d="M40.0 31a10 10 0 0 1 10 10v40a10 10 0 0 0 10 10">
</path><g>
<path d="M60.0 91h24.0">
</path><path d="M232.0 91h24.0">
</path><rect height=22 width=148 x=84.0 y=80>
</rect><text x=158.0 y=95>
non-relative-url</text></g><path d="M256.0 91a10 10 0 0 0 10 -10v-40a10 10 0 0 1 10 -10">
</path><path d="M40.0 31a10 10 0 0 1 10 10v70a10 10 0 0 0 10 10">
</path><g>
<path d="M60.0 121h40.0">
</path><path d="M216.0 121h40.0">
</path><rect height=22 width=116 x=100.0 y=110>
</rect><text x=158.0 y=125>
relative-url</text></g><path d="M256.0 121a10 10 0 0 0 10 -10v-70a10 10 0 0 1 10 -10">
</path></g><path d="M 276 31 h 20 m -10 -10 v 20 m 10 -20 v 20">
</path></g></svg></div>

<p>There are four unique syntaxes for
<a href="<code>https://url.spec.whatwg.org/#concept-url</code>">URL</a>s,
each returning a set of components, namely one or more of the following:
<a href="<code>https://url.spec.whatwg.org/#concept-url-scheme</code>">scheme</a>,
<a href="<code>https://url.spec.whatwg.org/#concept-url-scheme-data</code>">scheme_data</a>,
<a href="<code>https://url.spec.whatwg.org/#concept-url-username</code>">username</a>,
<a href="<code>https://url.spec.whatwg.org/#concept-url-password</code>">password</a>,
<a href="<code>https://url.spec.whatwg.org/#concept-url-host</code>">host</a>,
<a href="<code>https://url.spec.whatwg.org/#concept-url-port</code>">port</a>,
<a href="<code>https://url.spec.whatwg.org/#concept-url-path</code>">path</a>,
<a href="<code>https://url.spec.whatwg.org/#concept-url-query</code>">query</a>, and
<a href="<code>https://url.spec.whatwg.org/#concept-url-fragment</code>">fragment</a>.</p>

<p>In the case of a <code class=grammar-rule>relative-url</code>, the <code>result</code> object to be returned is
initialized to the value returned by <code class=grammar-rule>relative-url</code>, and then modify it as
follows before being returned:</p>
<ul><li data-md=""><p>Set <code>result.scheme</code> to <code>base.scheme.</code></p>
<li data-md=""><p>Set <code>result.host</code> to <code>base.host.</code></p>
<li data-md=""><p>Replace <code>result.path</code> by the <a data-link-type=dfn href=#path-concatenation title="path concatenation">path concatenation</a> of <code>base.path</code> and
<code>result.Path.</code></p>
</ul>
<p>In all other cases, the value returned by the called production is returned
unmodified.</p>

<h3 class="heading settled" data-level=3.2 id=file-like-relative-url><span class=secno>3.2. </span><span class=content>file-like-relative-url</span><a class=self-link href=#file-like-relative-url></a></h3>

<div class=railroad><svg class=railroad-diagram height=200 viewBox="0 0 901 200" width=901>
<g transform="translate(.5 .5)">
<path d="M 20 31 v 20 m 10 -20 v 20 m -10 -10 h 20.5">
</path><g>
<path d="M40 41h0.0">
</path><path d="M860.0 41h0.0">
</path><path d="M40.0 41h20">
</path><g>
<path d="M60.0 41h0.0">
</path><path d="M840.0 41h0.0">
</path><path d="M60.0 41h10">
</path><g>
<path d="M70.0 41h0.0">
</path><path d="M290.0 41h0.0">
</path><rect height=22 width=220 x=70.0 y=30>
</rect><text x=180.0 y=45>
file-like-relative-scheme</text></g><path d="M290.0 41h10">
</path><path d="M300.0 41h10">
</path><g>
<path d="M310.0 41h0.0">
</path><path d="M338.0 41h0.0">
</path><rect height=22 rx=10 ry=10 width=28 x=310.0 y=30>
</rect><text x=324.0 y=45>
:</text></g><path d="M338.0 41h10">
</path><path d="M348.0 41h10">
</path><g>
<path d="M358.0 41h0.0">
</path><path d="M498.0 41h0.0">
</path><rect height=22 rx=10 ry=10 width=140 x=358.0 y=30>
</rect><text x=428.0 y=45>
any of [a-zA-Z]</text></g><path d="M498.0 41h10">
</path><path d="M508.0 41h10">
</path><g>
<path d="M518.0 41h0.0">
</path><path d="M626.0 41h0.0">
</path><rect height=22 rx=10 ry=10 width=108 x=518.0 y=30>
</rect><text x=572.0 y=45>
any of [:|]</text></g><path d="M626.0 41h10">
</path><g>
<path d="M636.0 41h0.0">
</path><path d="M704.0 41h0.0">
</path><path d="M636.0 41a10 10 0 0 0 10 -10v0a10 10 0 0 1 10 -10">
</path><g>
<path d="M656.0 21h28">
</path></g><path d="M684.0 21a10 10 0 0 1 10 10v0a10 10 0 0 0 10 10">
</path><path d="M636.0 41h20">
</path><g>
<path d="M656.0 41h0.0">
</path><path d="M684.0 41h0.0">
</path><rect height=22 rx=10 ry=10 width=28 x=656.0 y=30>
</rect><text x=670.0 y=45>
/</text></g><path d="M684.0 41h20">
</path></g><path d="M704.0 41h10">
</path><g>
<path d="M714.0 41h0.0">
</path><path d="M830.0 41h0.0">
</path><rect height=22 width=116 x=714.0 y=30>
</rect><text x=772.0 y=45>
relative-url</text></g><path d="M830.0 41h10">
</path></g><path d="M840.0 41h20">
</path><path d="M40.0 41a10 10 0 0 1 10 10v20a10 10 0 0 0 10 10">
</path><g>
<path d="M60.0 81h140.0">
</path><path d="M700.0 81h140.0">
</path><g>
<path d="M200.0 81h0.0">
</path><path d="M288.0 81h0.0">
</path><path d="M200.0 81a10 10 0 0 0 10 -10v0a10 10 0 0 1 10 -10">
</path><g>
<path d="M220.0 61h48">
</path></g><path d="M268.0 61a10 10 0 0 1 10 10v0a10 10 0 0 0 10 10">
</path><path d="M200.0 81h20">
</path><g>
<path d="M220.0 81h0.0">
</path><path d="M268.0 81h0.0">
</path><path d="M220.0 81h10">
</path><g>
<path d="M230.0 81h0.0">
</path><path d="M258.0 81h0.0">
</path><rect height=22 rx=10 ry=10 width=28 x=230.0 y=70>
</rect><text x=244.0 y=85>
/</text></g><path d="M258.0 81h10">
</path><path d="M230.0 81a10 10 0 0 0 -10 10v0a10 10 0 0 0 10 10">
</path><g>
<path d="M230.0 101h28">
</path></g><path d="M258.0 101a10 10 0 0 0 10 -10v0a10 10 0 0 0 -10 -10">
</path></g><path d="M268.0 81h20">
</path></g><path d="M288.0 81h10">
</path><g>
<path d="M298.0 81h0.0">
</path><path d="M438.0 81h0.0">
</path><rect height=22 rx=10 ry=10 width=140 x=298.0 y=70>
</rect><text x=368.0 y=85>
any of [a-zA-Z]</text></g><path d="M438.0 81h10">
</path><path d="M448.0 81h10">
</path><g>
<path d="M458.0 81h0.0">
</path><path d="M486.0 81h0.0">
</path><rect height=22 rx=10 ry=10 width=28 x=458.0 y=70>
</rect><text x=472.0 y=85>
|</text></g><path d="M486.0 81h10">
</path><g>
<path d="M496.0 81h0.0">
</path><path d="M564.0 81h0.0">
</path><path d="M496.0 81a10 10 0 0 0 10 -10v0a10 10 0 0 1 10 -10">
</path><g>
<path d="M516.0 61h28">
</path></g><path d="M544.0 61a10 10 0 0 1 10 10v0a10 10 0 0 0 10 10">
</path><path d="M496.0 81h20">
</path><g>
<path d="M516.0 81h0.0">
</path><path d="M544.0 81h0.0">
</path><rect height=22 rx=10 ry=10 width=28 x=516.0 y=70>
</rect><text x=530.0 y=85>
/</text></g><path d="M544.0 81h20">
</path></g><path d="M564.0 81h10">
</path><g>
<path d="M574.0 81h0.0">
</path><path d="M690.0 81h0.0">
</path><rect height=22 width=116 x=574.0 y=70>
</rect><text x=632.0 y=85>
relative-url</text></g><path d="M690.0 81h10">
</path></g><path d="M840.0 81a10 10 0 0 0 10 -10v-20a10 10 0 0 1 10 -10">
</path><path d="M40.0 41a10 10 0 0 1 10 10v69a10 10 0 0 0 10 10">
</path><g>
<path d="M60.0 130h214.0">
</path><path d="M626.0 130h214.0">
</path><path d="M274.0 130h10">
</path><g>
<path d="M284.0 130h0.0">
</path><path d="M312.0 130h0.0">
</path><rect height=22 rx=10 ry=10 width=28 x=284.0 y=119>
</rect><text x=298.0 y=134>
/</text></g><path d="M312.0 130h10">
</path><path d="M322.0 130h10">
</path><g>
<path d="M332.0 130h0.0">
</path><path d="M360.0 130h0.0">
</path><rect height=22 rx=10 ry=10 width=28 x=332.0 y=119>
</rect><text x=346.0 y=134>
/</text></g><path d="M360.0 130h10">
</path><path d="M370.0 130h10">
</path><g>
<path d="M380.0 130h0.0">
</path><path d="M432.0 130h0.0">
</path><rect height=22 width=52 x=380.0 y=119>
</rect><text x=406.0 y=134>
host</text></g><path d="M432.0 130h10">
</path><path d="M442.0 130h10">
</path><g>
<path d="M452.0 130h0.0">
</path><path d="M480.0 130h0.0">
</path><rect height=22 rx=10 ry=10 width=28 x=452.0 y=119>
</rect><text x=466.0 y=134>
/</text></g><path d="M480.0 130h10">
</path><path d="M490.0 130h10">
</path><g>
<path d="M500.0 130h0.0">
</path><path d="M616.0 130h0.0">
</path><rect height=22 width=116 x=500.0 y=119>
</rect><text x=558.0 y=134>
relative-url</text></g><path d="M616.0 130h10">
</path></g><path d="M840.0 130a10 10 0 0 0 10 -10v-69a10 10 0 0 1 10 -10">
</path><path d="M40.0 41a10 10 0 0 1 10 10v99a10 10 0 0 0 10 10">
</path><g>
<path d="M60.0 160h30.0">
</path><path d="M810.0 160h30.0">
</path><path d="M90.0 160h10">
</path><g>
<path d="M100.0 160h0.0">
</path><path d="M320.0 160h0.0">
</path><rect height=22 width=220 x=100.0 y=149>
</rect><text x=210.0 y=164>
file-like-relative-scheme</text></g><path d="M320.0 160h10">
</path><path d="M330.0 160h10">
</path><g>
<path d="M340.0 160h0.0">
</path><path d="M368.0 160h0.0">
</path><rect height=22 rx=10 ry=10 width=28 x=340.0 y=149>
</rect><text x=354.0 y=164>
:</text></g><path d="M368.0 160h10">
</path><g>
<path d="M378.0 160h0.0">
</path><path d="M586.0 160h0.0">
</path><path d="M378.0 160a10 10 0 0 0 10 -10v0a10 10 0 0 1 10 -10">
</path><g>
<path d="M398.0 140h168">
</path></g><path d="M566.0 140a10 10 0 0 1 10 10v0a10 10 0 0 0 10 10">
</path><path d="M378.0 160h20">
</path><g>
<path d="M398.0 160h0.0">
</path><path d="M566.0 160h0.0">
</path><path d="M398.0 160h10">
</path><g>
<path d="M408.0 160h0.0">
</path><path d="M436.0 160h0.0">
</path><rect height=22 rx=10 ry=10 width=28 x=408.0 y=149>
</rect><text x=422.0 y=164>
/</text></g><path d="M436.0 160h10">
</path><path d="M446.0 160h10">
</path><g>
<path d="M456.0 160h0.0">
</path><path d="M484.0 160h0.0">
</path><rect height=22 rx=10 ry=10 width=28 x=456.0 y=149>
</rect><text x=470.0 y=164>
/</text></g><path d="M484.0 160h10">
</path><path d="M494.0 160h10">
</path><g>
<path d="M504.0 160h0.0">
</path><path d="M556.0 160h0.0">
</path><rect height=22 width=52 x=504.0 y=149>
</rect><text x=530.0 y=164>
host</text></g><path d="M556.0 160h10">
</path></g><path d="M566.0 160h20">
</path></g><g>
<path d="M586.0 160h0.0">
</path><path d="M674.0 160h0.0">
</path><path d="M586.0 160a10 10 0 0 0 10 -10v0a10 10 0 0 1 10 -10">
</path><g>
<path d="M606.0 140h48">
</path></g><path d="M654.0 140a10 10 0 0 1 10 10v0a10 10 0 0 0 10 10">
</path><path d="M586.0 160h20">
</path><g>
<path d="M606.0 160h0.0">
</path><path d="M654.0 160h0.0">
</path><path d="M606.0 160h10">
</path><g>
<path d="M616.0 160h0.0">
</path><path d="M644.0 160h0.0">
</path><rect height=22 rx=10 ry=10 width=28 x=616.0 y=149>
</rect><text x=630.0 y=164>
/</text></g><path d="M644.0 160h10">
</path><path d="M616.0 160a10 10 0 0 0 -10 10v0a10 10 0 0 0 10 10">
</path><g>
<path d="M616.0 180h28">
</path></g><path d="M644.0 180a10 10 0 0 0 10 -10v0a10 10 0 0 0 -10 -10">
</path></g><path d="M654.0 160h20">
</path></g><path d="M674.0 160h10">
</path><g>
<path d="M684.0 160h0.0">
</path><path d="M800.0 160h0.0">
</path><rect height=22 width=116 x=684.0 y=149>
</rect><text x=742.0 y=164>
relative-url</text></g><path d="M800.0 160h10">
</path></g><path d="M840.0 160a10 10 0 0 0 10 -10v-99a10 10 0 0 1 10 -10">
</path></g><path d="M 860 41 h 20 m -10 -10 v 20 m 10 -20 v 20">
</path></g></svg></div>

<p>Four production rules are defined for files, numbered from top to bottom.</p>

<p>Evaluation instructions for each:</p>

 <ol>
 <li>Set <code>result</code> to the object returned by
 <code class=grammar-rule>relative-url</code>, and then modify it as follows:

<ul><li data-md=""><p>Set <code>result.scheme</code> to the value returned by
 <code class=grammar-rule>file-like-relative-scheme</code>.</p>
<li data-md=""><p>Remove the first element from <code>result.path</code> if it is an empty
 string and if there is a second element which has a non-empty value.</p>
<li data-md=""><p>Construct a string using the alphabetic
 character following the first "<code>:</code>" in the input
 concatenated with a "<code>:</code>".  Prepend this string to 
 <code>result.path.</code></p>
</ul>
 <li>Indicate a <a data-link-type=dfn href=#parse-errors title="parse error">parse error</a>.

<p>Set <code>result</code> to the object returned by
 <code class=grammar-rule>relative-url</code>, and then modify it as follows:</p>

<ul><li data-md=""><p>Set <code>result.scheme</code> to "<code>file</code>".</p>
<li data-md=""><p>Remove the first element from <code>result.path</code> if it is an empty
 string and if there is a second element which has a non-empty value.</p>
<li data-md=""><p>Construct a string consisting of the character following
 the initial "<code>/</code>" (if any) in the production rule concatenated
 with a "<code>:</code>".  Prepend this string to the <code>result.path</code> array.</p>
</ul>
 <li><em>This rule is only to be evaluated if the value of
 <code>base.scheme</code> is "<code>file</code>"</em>.  Set <code>result</code> to the object returned by
 <code class=grammar-rule>relative-url</code>, and then modify it as follows:

<ul><li data-md=""><p>Set <code>result.scheme</code> to "<code>file</code>".</p>
<li data-md=""><p>Set <code>result.host</code> to the value returned by the
 <code class=grammar-rule>host</code> production rule.</p>
<li data-md=""><p>Remove the first element of the path if it is an empty string and
 there is a second element which has a non-empty value.</p>
</ul>
 <li>Set <code>result</code> to the object returned by
 <code class=grammar-rule>relative-url</code>, and then modify it as follows:

<ul><li data-md=""><p>Set <code>result.scheme</code> to the value returned by
 <code class=grammar-rule>file-like-relative-scheme</code></p>
<li data-md=""><p>If the <code class=grammar-rule>host</code> is present in the input, set <code>result.host</code>
 to the value returned by the <code class=grammar-rule>host</code> production rule</p>
<li data-md=""><p>If the <code class=grammar-rule>host</code> is not present and no slashes precede the
 <code class=grammar-rule>relative-url</code> in the input, then the <code>base.path</code>
 minus the last element is prepended to the <code>result.path.</code></p>
</ul>
 </ol>

<p>Return <code>result.</code></p>

<p class=note>Note: at the present time, file like relative URLs are generally not
interoperable, and therefore are effectively implementation defined.
Furthermore, the parsing rules in this section have not enjoyed wide review,
and therefore are more likely to be subject to change than other parts of this
specification.</p>

<h3 class="heading settled" data-level=3.3 id=file-like-relative-scheme><span class=secno>3.3. </span><span class=content>file-like-relative-scheme</span><a class=self-link href=#file-like-relative-scheme></a></h3>

<div class=railroad><svg class=railroad-diagram height=62 viewBox="0 0 153 62" width=153>
<g transform="translate(.5 .5)">
<path d="M 20 21 v 20 m 10 -20 v 20 m -10 -10 h 20.5">
</path><path d="M40 31h10">
</path><g>
<path d="M50 31h0.0">
</path><path d="M102.0 31h0.0">
</path><rect height=22 rx=10 ry=10 width=52 x=50.0 y=20>
</rect><text x=76.0 y=35>
file</text></g><path d="M102 31h10">
</path><path d="M 112 31 h 20 m -10 -10 v 20 m 10 -20 v 20">
</path></g></svg></div>

<p>Only one "file like" relative scheme is defined at this time:
"<code>file</code>".  This scheme is to be matched case insensitively.
This production rule is to return the scheme value, lowercased.</p>

<h3 class="heading settled" data-level=3.4 id=absolute-url><span class=secno>3.4. </span><span class=content>absolute-url</span><a class=self-link href=#absolute-url></a></h3>

<div class=railroad><svg class=railroad-diagram height=111 viewBox="0 0 1317 111" width=1317>
<g transform="translate(.5 .5)">
<path d="M 20 31 v 20 m 10 -20 v 20 m -10 -10 h 20.5">
</path><g>
<path d="M40 41h0.0">
</path><path d="M1276.0 41h0.0">
</path><path d="M40.0 41h20">
</path><g>
<path d="M60.0 41h0.0">
</path><path d="M1256.0 41h0.0">
</path><g>
<path d="M60.0 41h0.0">
</path><path d="M308.0 41h0.0">
</path><path d="M60.0 41a10 10 0 0 0 10 -10v0a10 10 0 0 1 10 -10">
</path><g>
<path d="M80.0 21h208">
</path></g><path d="M288.0 21a10 10 0 0 1 10 10v0a10 10 0 0 0 10 10">
</path><path d="M60.0 41h20">
</path><g>
<path d="M80.0 41h0.0">
</path><path d="M288.0 41h0.0">
</path><path d="M80.0 41h10">
</path><g>
<path d="M90.0 41h0.0">
</path><path d="M230.0 41h0.0">
</path><rect height=22 width=140 x=90.0 y=30>
</rect><text x=160.0 y=45>
relative-scheme</text></g><path d="M230.0 41h10">
</path><path d="M240.0 41h10">
</path><g>
<path d="M250.0 41h0.0">
</path><path d="M278.0 41h0.0">
</path><rect height=22 rx=10 ry=10 width=28 x=250.0 y=30>
</rect><text x=264.0 y=45>
:</text></g><path d="M278.0 41h10">
</path></g><path d="M288.0 41h20">
</path></g><path d="M308.0 41h10">
</path><g>
<path d="M318.0 41h0.0">
</path><path d="M434.0 41h0.0">
</path><rect height=22 rx=10 ry=10 width=116 x=318.0 y=30>
</rect><text x=376.0 y=45>
any of [/\\]</text></g><path d="M434.0 41h10">
</path><path d="M444.0 41h10">
</path><g>
<path d="M454.0 41h0.0">
</path><path d="M590.0 41h0.0">
</path><path d="M454.0 41h10">
</path><g>
<path d="M464.0 41h0.0">
</path><path d="M580.0 41h0.0">
</path><rect height=22 rx=10 ry=10 width=116 x=464.0 y=30>
</rect><text x=522.0 y=45>
any of [/\\]</text></g><path d="M580.0 41h10">
</path><path d="M464.0 41a10 10 0 0 0 -10 10v0a10 10 0 0 0 10 10">
</path><g>
<path d="M464.0 61h116">
</path></g><path d="M580.0 61a10 10 0 0 0 10 -10v0a10 10 0 0 0 -10 -10">
</path></g><path d="M590.0 41h10">
</path><g>
<path d="M600.0 41h0.0">
</path><path d="M732.0 41h0.0">
</path><path d="M600.0 41a10 10 0 0 0 10 -10v0a10 10 0 0 1 10 -10">
</path><g>
<path d="M620.0 21h92">
</path></g><path d="M712.0 21a10 10 0 0 1 10 10v0a10 10 0 0 0 10 10">
</path><path d="M600.0 41h20">
</path><g>
<path d="M620.0 41h0.0">
</path><path d="M712.0 41h0.0">
</path><rect height=22 width=92 x=620.0 y=30>
</rect><text x=666.0 y=45>
user-info</text></g><path d="M712.0 41h20">
</path></g><path d="M732.0 41h10">
</path><g>
<path d="M742.0 41h0.0">
</path><path d="M794.0 41h0.0">
</path><rect height=22 width=52 x=742.0 y=30>
</rect><text x=768.0 y=45>
host</text></g><path d="M794.0 41h10">
</path><g>
<path d="M804.0 41h0.0">
</path><path d="M964.0 41h0.0">
</path><path d="M804.0 41a10 10 0 0 0 10 -10v0a10 10 0 0 1 10 -10">
</path><g>
<path d="M824.0 21h120">
</path></g><path d="M944.0 21a10 10 0 0 1 10 10v0a10 10 0 0 0 10 10">
</path><path d="M804.0 41h20">
</path><g>
<path d="M824.0 41h0.0">
</path><path d="M944.0 41h0.0">
</path><path d="M824.0 41h10">
</path><g>
<path d="M834.0 41h0.0">
</path><path d="M862.0 41h0.0">
</path><rect height=22 rx=10 ry=10 width=28 x=834.0 y=30>
</rect><text x=848.0 y=45>
:</text></g><path d="M862.0 41h10">
</path><path d="M872.0 41h10">
</path><g>
<path d="M882.0 41h0.0">
</path><path d="M934.0 41h0.0">
</path><rect height=22 width=52 x=882.0 y=30>
</rect><text x=908.0 y=45>
port</text></g><path d="M934.0 41h10">
</path></g><path d="M944.0 41h20">
</path></g><g>
<path d="M964.0 41h0.0">
</path><path d="M1120.0 41h0.0">
</path><path d="M964.0 41a10 10 0 0 0 10 -10v0a10 10 0 0 1 10 -10">
</path><g>
<path d="M984.0 21h116">
</path></g><path d="M1100.0 21a10 10 0 0 1 10 10v0a10 10 0 0 0 10 10">
</path><path d="M964.0 41h20">
</path><g>
<path d="M984.0 41h0.0">
</path><path d="M1100.0 41h0.0">
</path><rect height=22 rx=10 ry=10 width=116 x=984.0 y=30>
</rect><text x=1042.0 y=45>
any of [/\\]</text></g><path d="M1100.0 41h20">
</path></g><path d="M1120.0 41h10">
</path><g>
<path d="M1130.0 41h0.0">
</path><path d="M1246.0 41h0.0">
</path><rect height=22 width=116 x=1130.0 y=30>
</rect><text x=1188.0 y=45>
relative-url</text></g><path d="M1246.0 41h10">
</path></g><path d="M1256.0 41h20">
</path><path d="M40.0 41a10 10 0 0 1 10 10v19a10 10 0 0 0 10 10">
</path><g>
<path d="M60.0 80h426.0">
</path><path d="M830.0 80h426.0">
</path><path d="M486.0 80h10">
</path><g>
<path d="M496.0 80h0.0">
</path><path d="M636.0 80h0.0">
</path><rect height=22 width=140 x=496.0 y=69>
</rect><text x=566.0 y=84>
relative-scheme</text></g><path d="M636.0 80h10">
</path><path d="M646.0 80h10">
</path><g>
<path d="M656.0 80h0.0">
</path><path d="M684.0 80h0.0">
</path><rect height=22 rx=10 ry=10 width=28 x=656.0 y=69>
</rect><text x=670.0 y=84>
:</text></g><path d="M684.0 80h10">
</path><path d="M694.0 80h10">
</path><g>
<path d="M704.0 80h0.0">
</path><path d="M820.0 80h0.0">
</path><rect height=22 width=116 x=704.0 y=69>
</rect><text x=762.0 y=84>
relative-url</text></g><path d="M820.0 80h10">
</path></g><path d="M1256.0 80a10 10 0 0 0 10 -10v-19a10 10 0 0 1 10 -10">
</path></g><path d="M 1276 41 h 20 m -10 -10 v 20 m 10 -20 v 20">
</path></g></svg></div>

<p>Two production rules are defined for absolute URLs, numbered from top to
bottom.</p>

<p>Evaluation instructions for each:</p>

<ol>
<li>If anything other than two forward solidus characters ("<code>//</code>") immediately
  follows the first colon in the input, indicate a <a data-link-type=dfn href=#parse-errors title="parse error">parse error</a>.

<p>Set <code>result</code> to the object returned by
  <code class=grammar-rule>relative-url</code>, and then modify it as follows:</p>

<ul><li data-md=""><p>If <code class=grammar-rule>relative-scheme</code> is present in the input, then
set <code>result.scheme</code> to this value, lowercased.</p>
<li data-md=""><p>If <code class=grammar-rule>relative-scheme</code> is not present in the input, then
set <code>result.scheme</code> to the value of <code>base.scheme.</code></p>
<li data-md=""><p>Set <code>result.host</code> to the value returned by
<code class=grammar-rule>host</code> up to the first "<code>@</code>" sign, if any.  If no
"<code>@</code>" signs are present in the return value from the
<code class=grammar-rule>host</code> production, then set <code>result.host</code> to the
entire value.</p>
<li data-md=""><p>If one or more "<code>@</code>" signs are present in the value returned
by the <code class=grammar-rule>host</code> production, then perform the following steps:</p>
<ul><li data-md=""><p>Indicate a <a data-link-type=dfn href=#parse-errors title="parse error">parse error</a>.</p>
<li data-md=""><p>If the <code class=grammar-rule>user-info</code> is not present in the input, then substitute
<code>{"username": ""}</code> for the return value of
<code class=grammar-rule>user-info</code> in the remainder of this step.</p>
<li data-md=""><p>If <code>password</code> is present in the value for <code class=grammar-rule>user-info</code>,
replace it with "<code>%40</code>" repeated as many times as there are
"<code>@</code>" signs in the value returned by <code class=grammar-rule>host</code>,
concatenated with the value returned by <code class=grammar-rule>host</code> with
all of the "<code>@</code>" signs removed.</p>
<li data-md=""><p>If <code>password</code> is not present in the <code class=grammar-rule>user-info</code>,
replace the <code>user</code> in the <code class=grammar-rule>user-info</code> with
"<code>%40</code>" repeated as many times as there are "<code>@</code>"
signs in the value returned by <code class=grammar-rule>host</code>, concatenated with
the value returned by <code class=grammar-rule>host</code> with all of the
"<code>@</code>" signs removed.</p>
</ul><li data-md=""><p>If <code class=grammar-rule>user-info</code> is present (or computed per above), then
perform the following steps:</p>
<ul><li data-md=""><p>If <code>result.Host</code> is an empty string, then terminate parsing
with a <a data-link-type=dfn href=#parse-errors title="parse error">parse error</a>.</p>
<li data-md=""><p>Set <code>result.username</code> to the <code>username</code> value in the <code class=grammar-rule>user-info</code>.</p>
<li data-md=""><p>If <code>password</code> is non-null in the <code class=grammar-rule>user-info</code>, set
<code>result.password</code> to this value.</p>
</ul><li data-md=""><p>If the <code class=grammar-rule>port</code> is present and not equal to the
<a href="<code>https://url.spec.whatwg.org/#default-port</code>">default port</a>
that corresponds to the <code>response.scheme</code>, then set 
<code>result.port</code> to this value.</p>
</ul>
<li>Indicate a <a data-link-type=dfn href=#parse-errors title="parse error">parse error</a>.

<p>Initialize <code>result</code> to be the value returned by <code class=grammar-rule>relative-url</code>, and then
 modify it as follows:</p>

<ul><li data-md=""><p>Set <code>result.scheme</code> to value returned by <code class=grammar-rule>relative-scheme</code>, lowercased</p>
<li data-md=""><p>If <code>result.scheme</code> is equal to <code>base.scheme</code>, then perform the
following steps:</p>
<ul><li data-md=""><p>Set <code>result.host</code> to <code>base.host</code></p>
<li data-md=""><p>Replace <code>result.path</code> by the <a data-link-type=dfn href=#path-concatenation title="path concatenation">path concatenation</a> of
<code>base.path</code> and <code>result.path</code></p>
</ul><li data-md=""><p>If <code>result.scheme</code> is not equal to <code>base.scheme</code>, then perform the
following steps:</p>
<ul><li data-md=""><p>Remove all empty strings from the front of <code>result.path.</code></p>
<li data-md=""><p>If the first element of <code>result.path</code> does not contain an "<code>@</code>"
sign, then set <code>result.host</code> to this elements
value, and remove this element from <code>result.path.</code></p>
<li data-md=""><p>If the first element of the path does contain an "<code>@</code>"
sign, then remove this element from the path and 
perform the following steps with this value:</p>
<ul><li data-md=""><p>The part of this value that precedes the first "<code>@</code>"
is to be treated as an <code class=grammar-rule>user-info</code> value.  If it
contains a "<code>:</code>", set <code>result.username</code> to the value
up to the position of the first "<code>:</code>" and set
<code>result.password</code> to the value starting with the position
after the first "<code>:</code>".  If no "<code>:</code>" is present,
set <code>result.username</code> to this entire value.</p>
<li data-md=""><p>Set <code>result.host</code> to the value starting after the first
"<code>@</code>".</p>
</ul><li data-md=""><p>if <code>result.host</code> is either an empty string or contains a
colon, then terminate parsing with a <a data-link-type=dfn href=#parse-errors title="parse error">parse error</a>.</p>
</ul></ul>
</ol>

<h3 class="heading settled" data-level=3.5 id=relative-url><span class=secno>3.5. </span><span class=content>relative-url</span><a class=self-link href=#relative-url></a></h3>

<div class=railroad><svg class=railroad-diagram height=72 viewBox="0 0 533 72" width=533>
<g transform="translate(.5 .5)">
<path d="M 20 31 v 20 m 10 -20 v 20 m -10 -10 h 20.5">
</path><g>
<path d="M40 41h0.0">
</path><path d="M492.0 41h0.0">
</path><g>
<path d="M40.0 41h0.0">
</path><path d="M132.0 41h0.0">
</path><path d="M40.0 41a10 10 0 0 0 10 -10v0a10 10 0 0 1 10 -10">
</path><g>
<path d="M60.0 21h52">
</path></g><path d="M112.0 21a10 10 0 0 1 10 10v0a10 10 0 0 0 10 10">
</path><path d="M40.0 41h20">
</path><g>
<path d="M60.0 41h0.0">
</path><path d="M112.0 41h0.0">
</path><rect height=22 width=52 x=60.0 y=30>
</rect><text x=86.0 y=45>
path</text></g><path d="M112.0 41h20">
</path></g><g>
<path d="M132.0 41h0.0">
</path><path d="M300.0 41h0.0">
</path><path d="M132.0 41a10 10 0 0 0 10 -10v0a10 10 0 0 1 10 -10">
</path><g>
<path d="M152.0 21h128">
</path></g><path d="M280.0 21a10 10 0 0 1 10 10v0a10 10 0 0 0 10 10">
</path><path d="M132.0 41h20">
</path><g>
<path d="M152.0 41h0.0">
</path><path d="M280.0 41h0.0">
</path><path d="M152.0 41h10">
</path><g>
<path d="M162.0 41h0.0">
</path><path d="M190.0 41h0.0">
</path><rect height=22 rx=10 ry=10 width=28 x=162.0 y=30>
</rect><text x=176.0 y=45>
?</text></g><path d="M190.0 41h10">
</path><path d="M200.0 41h10">
</path><g>
<path d="M210.0 41h0.0">
</path><path d="M270.0 41h0.0">
</path><rect height=22 width=60 x=210.0 y=30>
</rect><text x=240.0 y=45>
query</text></g><path d="M270.0 41h10">
</path></g><path d="M280.0 41h20">
</path></g><g>
<path d="M300.0 41h0.0">
</path><path d="M492.0 41h0.0">
</path><path d="M300.0 41a10 10 0 0 0 10 -10v0a10 10 0 0 1 10 -10">
</path><g>
<path d="M320.0 21h152">
</path></g><path d="M472.0 21a10 10 0 0 1 10 10v0a10 10 0 0 0 10 10">
</path><path d="M300.0 41h20">
</path><g>
<path d="M320.0 41h0.0">
</path><path d="M472.0 41h0.0">
</path><path d="M320.0 41h10">
</path><g>
<path d="M330.0 41h0.0">
</path><path d="M358.0 41h0.0">
</path><rect height=22 rx=10 ry=10 width=28 x=330.0 y=30>
</rect><text x=344.0 y=45>
#</text></g><path d="M358.0 41h10">
</path><path d="M368.0 41h10">
</path><g>
<path d="M378.0 41h0.0">
</path><path d="M462.0 41h0.0">
</path><rect height=22 width=84 x=378.0 y=30>
</rect><text x=420.0 y=45>
fragment</text></g><path d="M462.0 41h10">
</path></g><path d="M472.0 41h20">
</path></g></g><path d="M 492 41 h 20 m -10 -10 v 20 m 10 -20 v 20">
</path></g></svg></div>

<p>Initialize <code>result</code> to be empty object.
If <code class=grammar-rule>path</code> is present in the input, set <code>result.path</code> to this value.
If <code class=grammar-rule>query</code> is present in the input, set <code>result.query</code> to this value.
If <code class=grammar-rule>fragment</code> is present in the input, set <code>result.fragment</code> to this value.
Return <code>result.</code></p>

<h3 class="heading settled" data-level=3.6 id=non-relative-url><span class=secno>3.6. </span><span class=content>non-relative-url</span><a class=self-link href=#non-relative-url></a></h3>

<div class=railroad><svg class=railroad-diagram height=72 viewBox="0 0 649 72" width=649>
<g transform="translate(.5 .5)">
<path d="M 20 31 v 20 m 10 -20 v 20 m -10 -10 h 20.5">
</path><g>
<path d="M40 41h0.0">
</path><path d="M608.0 41h0.0">
</path><path d="M40.0 41h10">
</path><g>
<path d="M50.0 41h0.0">
</path><path d="M118.0 41h0.0">
</path><rect height=22 width=68 x=50.0 y=30>
</rect><text x=84.0 y=45>
scheme</text></g><path d="M118.0 41h10">
</path><path d="M128.0 41h10">
</path><g>
<path d="M138.0 41h0.0">
</path><path d="M166.0 41h0.0">
</path><rect height=22 rx=10 ry=10 width=28 x=138.0 y=30>
</rect><text x=152.0 y=45>
:</text></g><path d="M166.0 41h10">
</path><path d="M176.0 41h10">
</path><g>
<path d="M186.0 41h0.0">
</path><path d="M238.0 41h0.0">
</path><rect height=22 width=52 x=186.0 y=30>
</rect><text x=212.0 y=45>
data</text></g><path d="M238.0 41h10">
</path><g>
<path d="M248.0 41h0.0">
</path><path d="M416.0 41h0.0">
</path><path d="M248.0 41a10 10 0 0 0 10 -10v0a10 10 0 0 1 10 -10">
</path><g>
<path d="M268.0 21h128">
</path></g><path d="M396.0 21a10 10 0 0 1 10 10v0a10 10 0 0 0 10 10">
</path><path d="M248.0 41h20">
</path><g>
<path d="M268.0 41h0.0">
</path><path d="M396.0 41h0.0">
</path><path d="M268.0 41h10">
</path><g>
<path d="M278.0 41h0.0">
</path><path d="M306.0 41h0.0">
</path><rect height=22 rx=10 ry=10 width=28 x=278.0 y=30>
</rect><text x=292.0 y=45>
?</text></g><path d="M306.0 41h10">
</path><path d="M316.0 41h10">
</path><g>
<path d="M326.0 41h0.0">
</path><path d="M386.0 41h0.0">
</path><rect height=22 width=60 x=326.0 y=30>
</rect><text x=356.0 y=45>
query</text></g><path d="M386.0 41h10">
</path></g><path d="M396.0 41h20">
</path></g><g>
<path d="M416.0 41h0.0">
</path><path d="M608.0 41h0.0">
</path><path d="M416.0 41a10 10 0 0 0 10 -10v0a10 10 0 0 1 10 -10">
</path><g>
<path d="M436.0 21h152">
</path></g><path d="M588.0 21a10 10 0 0 1 10 10v0a10 10 0 0 0 10 10">
</path><path d="M416.0 41h20">
</path><g>
<path d="M436.0 41h0.0">
</path><path d="M588.0 41h0.0">
</path><path d="M436.0 41h10">
</path><g>
<path d="M446.0 41h0.0">
</path><path d="M474.0 41h0.0">
</path><rect height=22 rx=10 ry=10 width=28 x=446.0 y=30>
</rect><text x=460.0 y=45>
#</text></g><path d="M474.0 41h10">
</path><path d="M484.0 41h10">
</path><g>
<path d="M494.0 41h0.0">
</path><path d="M578.0 41h0.0">
</path><rect height=22 width=84 x=494.0 y=30>
</rect><text x=536.0 y=45>
fragment</text></g><path d="M578.0 41h10">
</path></g><path d="M588.0 41h20">
</path></g></g><path d="M 608 41 h 20 m -10 -10 v 20 m 10 -20 v 20">
</path></g></svg></div>

<p>Initialize <code>result</code> to be a JSON object with <code>scheme</code>
set to be the result returned by <code class=grammar-rule>scheme</code>, and
<code>scheme_data</code> set to the result returned by <code class=grammar-rule>data</code>.
If <code class=grammar-rule>query</code> is present in the input, set <code>result.query</code> to this value.
If <code class=grammar-rule>fragment</code> is present in the input, set <code>result.fragment</code> to this value.
Return <code>result.</code></p>

<h3 class="heading settled" data-level=3.7 id=relative-scheme><span class=secno>3.7. </span><span class=content>relative-scheme</span><a class=self-link href=#relative-scheme></a></h3>

<div class=railroad><svg class=railroad-diagram height=212 viewBox="0 0 189 212" width=189>
<g transform="translate(.5 .5)">
<path d="M 20 21 v 20 m 10 -20 v 20 m -10 -10 h 20.5">
</path><g>
<path d="M40 31h0.0">
</path><path d="M148.0 31h0.0">
</path><path d="M40.0 31h20">
</path><g>
<path d="M60.0 31h12.0">
</path><path d="M116.0 31h12.0">
</path><rect height=22 rx=10 ry=10 width=44 x=72.0 y=20>
</rect><text x=94.0 y=35>
ftp</text></g><path d="M128.0 31h20">
</path><path d="M40.0 31a10 10 0 0 1 10 10v10a10 10 0 0 0 10 10">
</path><g>
<path d="M60.0 61h0.0">
</path><path d="M128.0 61h0.0">
</path><rect height=22 rx=10 ry=10 width=68 x=60.0 y=50>
</rect><text x=94.0 y=65>
gopher</text></g><path d="M128.0 61a10 10 0 0 0 10 -10v-10a10 10 0 0 1 10 -10">
</path><path d="M40.0 31a10 10 0 0 1 10 10v40a10 10 0 0 0 10 10">
</path><g>
<path d="M60.0 91h4.0">
</path><path d="M124.0 91h4.0">
</path><rect height=22 rx=10 ry=10 width=60 x=64.0 y=80>
</rect><text x=94.0 y=95>
https</text></g><path d="M128.0 91a10 10 0 0 0 10 -10v-40a10 10 0 0 1 10 -10">
</path><path d="M40.0 31a10 10 0 0 1 10 10v70a10 10 0 0 0 10 10">
</path><g>
<path d="M60.0 121h8.0">
</path><path d="M120.0 121h8.0">
</path><rect height=22 rx=10 ry=10 width=52 x=68.0 y=110>
</rect><text x=94.0 y=125>
http</text></g><path d="M128.0 121a10 10 0 0 0 10 -10v-70a10 10 0 0 1 10 -10">
</path><path d="M40.0 31a10 10 0 0 1 10 10v100a10 10 0 0 0 10 10">
</path><g>
<path d="M60.0 151h12.0">
</path><path d="M116.0 151h12.0">
</path><rect height=22 rx=10 ry=10 width=44 x=72.0 y=140>
</rect><text x=94.0 y=155>
wss</text></g><path d="M128.0 151a10 10 0 0 0 10 -10v-100a10 10 0 0 1 10 -10">
</path><path d="M40.0 31a10 10 0 0 1 10 10v130a10 10 0 0 0 10 10">
</path><g>
<path d="M60.0 181h16.0">
</path><path d="M112.0 181h16.0">
</path><rect height=22 rx=10 ry=10 width=36 x=76.0 y=170>
</rect><text x=94.0 y=185>
ws</text></g><path d="M128.0 181a10 10 0 0 0 10 -10v-130a10 10 0 0 1 10 -10">
</path></g><path d="M 148 31 h 20 m -10 -10 v 20 m 10 -20 v 20">
</path></g></svg></div>

<p>Six relative schemes are defined.  They are to be matched against the input
in a case insensitive manner.  Return the results as a lowercased string.</p>

<h3 class="heading settled" data-level=3.8 id=scheme><span class=secno>3.8. </span><span class=content>scheme</span><a class=self-link href=#scheme></a></h3>

<div class=railroad><svg class=railroad-diagram height=71 viewBox="0 0 285 71" width=285>
<g transform="translate(.5 .5)">
<path d="M 20 21 v 20 m 10 -20 v 20 m -10 -10 h 20.5">
</path><path d="M40 31h10">
</path><g>
<path d="M50 31h0.0">
</path><path d="M234.0 31h0.0">
</path><path d="M50.0 31h10">
</path><g>
<path d="M60.0 31h0.0">
</path><path d="M224.0 31h0.0">
</path><rect height=22 rx=10 ry=10 width=164 x=60.0 y=20>
</rect><text x=142.0 y=35>
any of [-a-zA-Z+.]</text></g><path d="M224.0 31h10">
</path><path d="M60.0 31a10 10 0 0 0 -10 10v0a10 10 0 0 0 10 10">
</path><g>
<path d="M60.0 51h164">
</path></g><path d="M224.0 51a10 10 0 0 0 10 -10v0a10 10 0 0 0 -10 -10">
</path></g><path d="M234 31h10">
</path><path d="M 244 31 h 20 m -10 -10 v 20 m 10 -20 v 20">
</path></g></svg></div>

<p>Schemes consist of one or more the letters "<code>a</code>" through
"<code>z</code>", "<code>A</code>" through "<code>Z</code>", or any of the
following special characters: hyphen-minus (<code>U+002D</code>),
plus sign (<code>U+002B</code>) or full stop (<code>U+002D</code>).
Return the results as a lowercased string.</p>

<h3 class="heading settled" data-level=3.9 id=user-info><span class=secno>3.9. </span><span class=content>user-info</span><a class=self-link href=#user-info></a></h3>

<div class=railroad><svg class=railroad-diagram height=72 viewBox="0 0 393 72" width=393>
<g transform="translate(.5 .5)">
<path d="M 20 31 v 20 m 10 -20 v 20 m -10 -10 h 20.5">
</path><g>
<path d="M40 41h0.0">
</path><path d="M352.0 41h0.0">
</path><path d="M40.0 41h10">
</path><g>
<path d="M50.0 41h0.0">
</path><path d="M102.0 41h0.0">
</path><rect height=22 width=52 x=50.0 y=30>
</rect><text x=76.0 y=45>
user</text></g><path d="M102.0 41h10">
</path><g>
<path d="M112.0 41h0.0">
</path><path d="M304.0 41h0.0">
</path><path d="M112.0 41a10 10 0 0 0 10 -10v0a10 10 0 0 1 10 -10">
</path><g>
<path d="M132.0 21h152">
</path></g><path d="M284.0 21a10 10 0 0 1 10 10v0a10 10 0 0 0 10 10">
</path><path d="M112.0 41h20">
</path><g>
<path d="M132.0 41h0.0">
</path><path d="M284.0 41h0.0">
</path><path d="M132.0 41h10">
</path><g>
<path d="M142.0 41h0.0">
</path><path d="M170.0 41h0.0">
</path><rect height=22 rx=10 ry=10 width=28 x=142.0 y=30>
</rect><text x=156.0 y=45>
:</text></g><path d="M170.0 41h10">
</path><path d="M180.0 41h10">
</path><g>
<path d="M190.0 41h0.0">
</path><path d="M274.0 41h0.0">
</path><rect height=22 width=84 x=190.0 y=30>
</rect><text x=232.0 y=45>
password</text></g><path d="M274.0 41h10">
</path></g><path d="M284.0 41h20">
</path></g><path d="M304.0 41h10">
</path><g>
<path d="M314.0 41h0.0">
</path><path d="M342.0 41h0.0">
</path><rect height=22 rx=10 ry=10 width=28 x=314.0 y=30>
</rect><text x=328.0 y=45>
@</text></g><path d="M342.0 41h10">
</path></g><path d="M 352 41 h 20 m -10 -10 v 20 m 10 -20 v 20">
</path></g></svg></div>

<p>Initialize <code>result</code> to be a JSON object with <code>user</code>
set to be the result returned by <code class=grammar-rule>user</code>.  If
<code class=grammar-rule>password</code> is present in the input, set <code>result.password</code>
to this value.  Return <code>result.</code></p>

<h3 class="heading settled" data-level=3.10 id=user><span class=secno>3.10. </span><span class=content>user</span><a class=self-link href=#user></a></h3>

<div class=railroad><svg class=railroad-diagram height=81 viewBox="0 0 321 81" width=321>
<g transform="translate(.5 .5)">
<path d="M 20 31 v 20 m 10 -20 v 20 m -10 -10 h 20.5">
</path><g>
<path d="M40 41h0.0">
</path><path d="M280.0 41h0.0">
</path><path d="M40.0 41a10 10 0 0 0 10 -10v0a10 10 0 0 1 10 -10">
</path><g>
<path d="M60.0 21h200">
</path></g><path d="M260.0 21a10 10 0 0 1 10 10v0a10 10 0 0 0 10 10">
</path><path d="M40.0 41h20">
</path><g>
<path d="M60.0 41h0.0">
</path><path d="M260.0 41h0.0">
</path><path d="M60.0 41h10">
</path><g>
<path d="M70.0 41h0.0">
</path><path d="M250.0 41h0.0">
</path><rect height=22 rx=10 ry=10 width=180 x=70.0 y=30>
</rect><text x=160.0 y=45>
any except [/\\?#@:]</text></g><path d="M250.0 41h10">
</path><path d="M70.0 41a10 10 0 0 0 -10 10v0a10 10 0 0 0 10 10">
</path><g>
<path d="M70.0 61h180">
</path></g><path d="M250.0 61a10 10 0 0 0 10 -10v0a10 10 0 0 0 -10 -10">
</path></g><path d="M260.0 41h20">
</path></g><path d="M 280 41 h 20 m -10 -10 v 20 m 10 -20 v 20">
</path></g></svg></div>

<p>Consume all characters until either
a solidus (<code>U+002F</code>),
a reverse solidus (<code>U+005C</code>),
a question mark (<code>U+003F</code>),
a number sign (<code>U+0023</code>), 
a commercial at (<code>U+0040</code>), 
a colon (<code>U+003A</code>), 
or the end of string is encountered.
Return the <a data-link-type=dfn href=#cleanse title=cleanse>cleansed</a> result using the
<a href="<code>https://url.spec.whatwg.org/#default-encode-set</code>">default encode
 set</a>.</p>

<h3 class="heading settled" data-level=3.11 id=password><span class=secno>3.11. </span><span class=content>password</span><a class=self-link href=#password></a></h3>

<div class=railroad><svg class=railroad-diagram height=81 viewBox="0 0 313 81" width=313>
<g transform="translate(.5 .5)">
<path d="M 20 31 v 20 m 10 -20 v 20 m -10 -10 h 20.5">
</path><g>
<path d="M40 41h0.0">
</path><path d="M272.0 41h0.0">
</path><path d="M40.0 41a10 10 0 0 0 10 -10v0a10 10 0 0 1 10 -10">
</path><g>
<path d="M60.0 21h192">
</path></g><path d="M252.0 21a10 10 0 0 1 10 10v0a10 10 0 0 0 10 10">
</path><path d="M40.0 41h20">
</path><g>
<path d="M60.0 41h0.0">
</path><path d="M252.0 41h0.0">
</path><path d="M60.0 41h10">
</path><g>
<path d="M70.0 41h0.0">
</path><path d="M242.0 41h0.0">
</path><rect height=22 rx=10 ry=10 width=172 x=70.0 y=30>
</rect><text x=156.0 y=45>
any except [/\\?#@]</text></g><path d="M242.0 41h10">
</path><path d="M70.0 41a10 10 0 0 0 -10 10v0a10 10 0 0 0 10 10">
</path><g>
<path d="M70.0 61h172">
</path></g><path d="M242.0 61a10 10 0 0 0 10 -10v0a10 10 0 0 0 -10 -10">
</path></g><path d="M252.0 41h20">
</path></g><path d="M 272 41 h 20 m -10 -10 v 20 m 10 -20 v 20">
</path></g></svg></div>

<p>Consume all characters until either
a solidus (<code>U+002F</code>),
a reverse solidus (<code>U+005C</code>),
a question mark (<code>U+003F</code>),
a number sign (<code>U+0023</code>), 
a commercial at (<code>U+0040</code>), 
or the end of string is encountered.
Return the <a data-link-type=dfn href=#cleanse title=cleanse>cleansed</a> result using the
<a href="<code>https://url.spec.whatwg.org/#default-encode-set</code>">default encode
 set</a>.</p>

<h3 class="heading settled" data-level=3.12 id=host><span class=secno>3.12. </span><span class=content>host</span><a class=self-link href=#host></a></h3>

<div class=railroad><svg class=railroad-diagram height=111 viewBox="0 0 353 111" width=353>
<g transform="translate(.5 .5)">
<path d="M 20 21 v 20 m 10 -20 v 20 m -10 -10 h 20.5">
</path><g>
<path d="M40 31h0.0">
</path><path d="M312.0 31h0.0">
</path><path d="M40.0 31h20">
</path><g>
<path d="M60.0 31h16.0">
</path><path d="M276.0 31h16.0">
</path><path d="M76.0 31h10">
</path><g>
<path d="M86.0 31h0.0">
</path><path d="M114.0 31h0.0">
</path><rect height=22 rx=10 ry=10 width=28 x=86.0 y=20>
</rect><text x=100.0 y=35>
[</text></g><path d="M114.0 31h10">
</path><path d="M124.0 31h10">
</path><g>
<path d="M134.0 31h0.0">
</path><path d="M218.0 31h0.0">
</path><rect height=22 width=84 x=134.0 y=20>
</rect><text x=176.0 y=35>
ipv6addr</text></g><path d="M218.0 31h10">
</path><path d="M228.0 31h10">
</path><g>
<path d="M238.0 31h0.0">
</path><path d="M266.0 31h0.0">
</path><rect height=22 rx=10 ry=10 width=28 x=238.0 y=20>
</rect><text x=252.0 y=35>
]</text></g><path d="M266.0 31h10">
</path></g><path d="M292.0 31h20">
</path><path d="M40.0 31a10 10 0 0 1 10 10v20a10 10 0 0 0 10 10">
</path><g>
<path d="M60.0 71h0.0">
</path><path d="M292.0 71h0.0">
</path><path d="M60.0 71a10 10 0 0 0 10 -10v0a10 10 0 0 1 10 -10">
</path><g>
<path d="M80.0 51h192">
</path></g><path d="M272.0 51a10 10 0 0 1 10 10v0a10 10 0 0 0 10 10">
</path><path d="M60.0 71h20">
</path><g>
<path d="M80.0 71h0.0">
</path><path d="M272.0 71h0.0">
</path><path d="M80.0 71h10">
</path><g>
<path d="M90.0 71h0.0">
</path><path d="M262.0 71h0.0">
</path><rect height=22 rx=10 ry=10 width=172 x=90.0 y=60>
</rect><text x=176.0 y=75>
any except [:/\\?#]</text></g><path d="M262.0 71h10">
</path><path d="M90.0 71a10 10 0 0 0 -10 10v0a10 10 0 0 0 10 10">
</path><g>
<path d="M90.0 91h172">
</path></g><path d="M262.0 91a10 10 0 0 0 10 -10v0a10 10 0 0 0 -10 -10">
</path></g><path d="M272.0 71h20">
</path></g><path d="M292.0 71a10 10 0 0 0 10 -10v-20a10 10 0 0 1 10 -10">
</path></g><path d="M 312 31 h 20 m -10 -10 v 20 m 10 -20 v 20">
</path></g></svg></div>

<p>If the input contains an <code class=grammar-rule>ipv6addr</code>, return "<code>[</code>" plus
the result returned by <code class=grammar-rule>ipv6addr</code> plus "<code>]</code>"  Otherwise:</p>

<ul><li data-md=""><p>If the string starts with a left square bracket (<code>U+005B</code>),
terminate parsing with a <a data-link-type=dfn href=#parse-errors title="parse error">parse error</a>.</p>
<li data-md=""><p>If any <code>U+0009</code>, <code>U+000A</code>,
<code>U+000D</code>, <code>U+200B</code>, <code>U+2060</code>, or <code>U+FEFF</code> characters are present in the input,
remove those characters and indicate a <a data-link-type=dfn href=#parse-errors title="parse error">parse error</a>.</p>
<li data-md=""><p><a href="<code>https://url.spec.whatwg.org/#percent-decode</code>">Utf8 percent
decode</a> the result.</p>
<li data-md=""><p>Replace all Fullwidth unicode characters (in the range of
<code>U+FF01</code> to <code>U+FF5E</code> )with their non-fullwidth
equivalents.</p>
<li data-md=""><p>If the result contains any character in the range of
<code>U+FDD0</code> to <code>U+FDEF</code>, terminate paring with a <a data-link-type=dfn href=#parse-errors title="parse error">parse error</a>.</p>
<li data-md=""><p>If the result contains any of the following, terminate parsing with a
<a data-link-type=dfn href=#parse-errors title="parse error">parse error</a>:
number sign (U+023),
percent (U+025),
solidus (U+02F),
reverse solidus (U+05C),
colon (U+03A),
question mark (U+03F),
left square bracket (U+05B),
right square bracket (U+05B),
null (<code>U+0000</code>),
tab (<code>U+0009</code>),
line feed (<code>U+000A</code>),
carriage return (<code>U+000D</code>),
space (<code>U+0020</code>),
no-break space (<code>U+00A0</code>),
ogham space mark (<code>U+1680</code>),
en quad (<code>U+2000</code>),
zero width space (<code>U+200B</code>),
narrow no-break space (<code>U+202F</code>),
medium mathematical space (<code>U+205F</code>), or
ideographic space (<code>U+3000</code>),</p>
<li data-md=""><p>IDNA encode the result as follows:</p>
<ul><li data-md=""><p>split the string whenever any of the following are encountered:
 <code>U+002E</code> (full stop), <code>U+3002</code> (ideographic
 full stop), <code>U+FF0E</code> (fullwidth full stop),
 <code>U+FF61</code> (halfwidth ideographic full stop)</p>
<li data-md=""><p>If any of the pieces contains any character outside of the range of
 <code>U+0020</code> to <code>U+007E</code>, replace that piece with
 the string "<code>xn--</code>" concatenated with the punycode
 <a data-biblio-type=normative data-link-type=biblio href=#biblio-rfc3492 title=RFC3492>[RFC3492]</a> encoded value of the result.</p>
<li data-md=""><p>If any of the pieces, other than the first one, are empty strings,
 indicate a <a data-link-type=dfn href=#parse-errors title="parse error">parse error</a>.</p>
<li data-md=""><p>Rejoin the pieces using <code>U+002E</code> (full stop) as the
 separator.</p>
</ul></ul>
<p class=note>Note: this description above needs to be reconciled with, and defer to,
the <a href=https://encoding.spec.whatwg.org/>Encoding
Living Standard</a>.  For example, full Unicode normalization is more than
simply converting full-width characters to their normal width equivalents.</p>

<h3 class="heading settled" data-level=3.13 id=ipv6addr><span class=secno>3.13. </span><span class=content>ipv6addr</span><a class=self-link href=#ipv6addr></a></h3>

<div class=railroad><svg class=railroad-diagram height=112 viewBox="0 0 605 112" width=605>
<g transform="translate(.5 .5)">
<path d="M 20 41 v 20 m 10 -20 v 20 m -10 -10 h 20.5">
</path><g>
<path d="M40 51h0.0">
</path><path d="M564.0 51h0.0">
</path><g>
<path d="M40.0 51h0.0">
</path><path d="M300.0 51h0.0">
</path><path d="M40.0 51a10 10 0 0 0 10 -10v-9a10 10 0 0 1 10 -10">
</path><g>
<path d="M60.0 22h220">
</path></g><path d="M280.0 22a10 10 0 0 1 10 10v9a10 10 0 0 0 10 10">
</path><path d="M40.0 51h20">
</path><g>
<path d="M60.0 51h0.0">
</path><path d="M280.0 51h0.0">
</path><g>
<path d="M60.0 51h0.0">
</path><path d="M232.0 51h0.0">
</path><path d="M60.0 51a10 10 0 0 0 10 -10v0a10 10 0 0 1 10 -10">
</path><g>
<path d="M80.0 31h132">
</path></g><path d="M212.0 31a10 10 0 0 1 10 10v0a10 10 0 0 0 10 10">
</path><path d="M60.0 51h20">
</path><g>
<path d="M80.0 51h0.0">
</path><path d="M212.0 51h0.0">
</path><path d="M80.0 51h10">
</path><g>
<path d="M90.0 51h0.0">
</path><path d="M202.0 51h0.0">
</path><path d="M90.0 51h10">
</path><g>
<path d="M100.0 51h0.0">
</path><path d="M144.0 51h0.0">
</path><rect height=22 width=44 x=100.0 y=40>
</rect><text x=122.0 y=55>
h16</text></g><path d="M144.0 51h10">
</path><path d="M154.0 51h10">
</path><g>
<path d="M164.0 51h0.0">
</path><path d="M192.0 51h0.0">
</path><rect height=22 rx=10 ry=10 width=28 x=164.0 y=40>
</rect><text x=178.0 y=55>
:</text></g><path d="M192.0 51h10">
</path></g><path d="M202.0 51h10">
</path><path d="M90.0 51a10 10 0 0 0 -10 10v0a10 10 0 0 0 10 10">
</path><g>
<path d="M90.0 71h112">
</path></g><path d="M202.0 71a10 10 0 0 0 10 -10v0a10 10 0 0 0 -10 -10">
</path></g><path d="M212.0 51h20">
</path></g><path d="M232.0 51h10">
</path><g>
<path d="M242.0 51h0.0">
</path><path d="M270.0 51h0.0">
</path><rect height=22 rx=10 ry=10 width=28 x=242.0 y=40>
</rect><text x=256.0 y=55>
:</text></g><path d="M270.0 51h10">
</path></g><path d="M280.0 51h20">
</path></g><g>
<path d="M300.0 51h0.0">
</path><path d="M472.0 51h0.0">
</path><path d="M300.0 51a10 10 0 0 0 10 -10v0a10 10 0 0 1 10 -10">
</path><g>
<path d="M320.0 31h132">
</path></g><path d="M452.0 31a10 10 0 0 1 10 10v0a10 10 0 0 0 10 10">
</path><path d="M300.0 51h20">
</path><g>
<path d="M320.0 51h0.0">
</path><path d="M452.0 51h0.0">
</path><path d="M320.0 51h10">
</path><g>
<path d="M330.0 51h0.0">
</path><path d="M442.0 51h0.0">
</path><path d="M330.0 51h10">
</path><g>
<path d="M340.0 51h0.0">
</path><path d="M384.0 51h0.0">
</path><rect height=22 width=44 x=340.0 y=40>
</rect><text x=362.0 y=55>
h16</text></g><path d="M384.0 51h10">
</path><path d="M394.0 51h10">
</path><g>
<path d="M404.0 51h0.0">
</path><path d="M432.0 51h0.0">
</path><rect height=22 rx=10 ry=10 width=28 x=404.0 y=40>
</rect><text x=418.0 y=55>
:</text></g><path d="M432.0 51h10">
</path></g><path d="M442.0 51h10">
</path><path d="M330.0 51a10 10 0 0 0 -10 10v0a10 10 0 0 0 10 10">
</path><g>
<path d="M330.0 71h112">
</path></g><path d="M442.0 71a10 10 0 0 0 10 -10v0a10 10 0 0 0 -10 -10">
</path></g><path d="M452.0 51h20">
</path></g><g>
<path d="M472.0 51h0.0">
</path><path d="M564.0 51h0.0">
</path><path d="M472.0 51h20">
</path><g>
<path d="M492.0 51h4.0">
</path><path d="M540.0 51h4.0">
</path><rect height=22 width=44 x=496.0 y=40>
</rect><text x=518.0 y=55>
h16</text></g><path d="M544.0 51h20">
</path><path d="M472.0 51a10 10 0 0 1 10 10v10a10 10 0 0 0 10 10">
</path><g>
<path d="M492.0 81h0.0">
</path><path d="M544.0 81h0.0">
</path><rect height=22 width=52 x=492.0 y=70>
</rect><text x=518.0 y=85>
ls32</text></g><path d="M544.0 81a10 10 0 0 0 10 -10v-10a10 10 0 0 1 10 -10">
</path></g></g><path d="M 564 51 h 20 m -10 -10 v 20 m 10 -20 v 20">
</path></g></svg></div>

<p>In addition to parsing a series of zero or more <code class=grammar-rule>h16</code> values separated by a
 colon, optionally followed by a double colon and a series of zero or more
 #H16 values, optionally followed by a colon and a <code class=grammar-rule>ls32</code> value.</p>

<p>Perform the following validation checks:</p>
<ul><li data-md=""><p>If there are no consecutive colon characters in the input string, indicate
 a <a data-link-type=dfn href=#parse-errors title="parse error">parse error</a> and terminate processing unless there are exactly
 six <code class=grammar-rule>h16</code> values and one <code class=grammar-rule>ls32</code> value.</p>
<li data-md=""><p>If there are consecutive colon characters present in the input, indicate a
 <a data-link-type=dfn href=#parse-errors title="parse error">parse error</a> and terminate processing if the total number of values
 (<code class=grammar-rule>h16</code> or <code class=grammar-rule>ls32</code>) is more than six.</p>
<li data-md=""><p>Unless there is a <code class=grammar-rule>ls32</code> value present, indicate a <a data-link-type=dfn href=#parse-errors title="parse error">parse error</a> and
 terminate processing if consecutive colon characters are present in the
 input or if there are more than one <code class=grammar-rule>ls32</code> value after the consecutive
 colons.</p>
</ul>
<p>Return the result as a string.</p>

<h3 class="heading settled" data-level=3.14 id=h16><span class=secno>3.14. </span><span class=content>h16</span><a class=self-link href=#h16></a></h3>

<div class=railroad><svg class=railroad-diagram height=72 viewBox="0 0 877 72" width=877>
<g transform="translate(.5 .5)">
<path d="M 20 31 v 20 m 10 -20 v 20 m -10 -10 h 20.5">
</path><g>
<path d="M40 41h0.0">
</path><path d="M836.0 41h0.0">
</path><path d="M40.0 41h10">
</path><g>
<path d="M50.0 41h0.0">
</path><path d="M214.0 41h0.0">
</path><rect height=22 rx=10 ry=10 width=164 x=50.0 y=30>
</rect><text x=132.0 y=45>
any of [0-9A-Fa-f]</text></g><path d="M214.0 41h10">
</path><g>
<path d="M224.0 41h0.0">
</path><path d="M428.0 41h0.0">
</path><path d="M224.0 41a10 10 0 0 0 10 -10v0a10 10 0 0 1 10 -10">
</path><g>
<path d="M244.0 21h164">
</path></g><path d="M408.0 21a10 10 0 0 1 10 10v0a10 10 0 0 0 10 10">
</path><path d="M224.0 41h20">
</path><g>
<path d="M244.0 41h0.0">
</path><path d="M408.0 41h0.0">
</path><rect height=22 rx=10 ry=10 width=164 x=244.0 y=30>
</rect><text x=326.0 y=45>
any of [0-9A-Fa-f]</text></g><path d="M408.0 41h20">
</path></g><g>
<path d="M428.0 41h0.0">
</path><path d="M632.0 41h0.0">
</path><path d="M428.0 41a10 10 0 0 0 10 -10v0a10 10 0 0 1 10 -10">
</path><g>
<path d="M448.0 21h164">
</path></g><path d="M612.0 21a10 10 0 0 1 10 10v0a10 10 0 0 0 10 10">
</path><path d="M428.0 41h20">
</path><g>
<path d="M448.0 41h0.0">
</path><path d="M612.0 41h0.0">
</path><rect height=22 rx=10 ry=10 width=164 x=448.0 y=30>
</rect><text x=530.0 y=45>
any of [0-9A-Fa-f]</text></g><path d="M612.0 41h20">
</path></g><g>
<path d="M632.0 41h0.0">
</path><path d="M836.0 41h0.0">
</path><path d="M632.0 41a10 10 0 0 0 10 -10v0a10 10 0 0 1 10 -10">
</path><g>
<path d="M652.0 21h164">
</path></g><path d="M816.0 21a10 10 0 0 1 10 10v0a10 10 0 0 0 10 10">
</path><path d="M632.0 41h20">
</path><g>
<path d="M652.0 41h0.0">
</path><path d="M816.0 41h0.0">
</path><rect height=22 rx=10 ry=10 width=164 x=652.0 y=30>
</rect><text x=734.0 y=45>
any of [0-9A-Fa-f]</text></g><path d="M816.0 41h20">
</path></g></g><path d="M 836 41 h 20 m -10 -10 v 20 m 10 -20 v 20">
</path></g></svg></div>

<p>Return up to four hexadecimal characters as a string.</p>

<h3 class="heading settled" data-level=3.15 id=ls32><span class=secno>3.15. </span><span class=content>ls32</span><a class=self-link href=#ls32></a></h3>

<div class=railroad><svg class=railroad-diagram height=62 viewBox="0 0 769 62" width=769>
<g transform="translate(.5 .5)">
<path d="M 20 21 v 20 m 10 -20 v 20 m -10 -10 h 20.5">
</path><g>
<path d="M40 31h0.0">
</path><path d="M728.0 31h0.0">
</path><path d="M40.0 31h10">
</path><g>
<path d="M50.0 31h0.0">
</path><path d="M166.0 31h0.0">
</path><rect height=22 width=116 x=50.0 y=20>
</rect><text x=108.0 y=35>
decimal_byte</text></g><path d="M166.0 31h10">
</path><path d="M176.0 31h10">
</path><g>
<path d="M186.0 31h0.0">
</path><path d="M214.0 31h0.0">
</path><rect height=22 rx=10 ry=10 width=28 x=186.0 y=20>
</rect><text x=200.0 y=35>
.</text></g><path d="M214.0 31h10">
</path><path d="M224.0 31h10">
</path><g>
<path d="M234.0 31h0.0">
</path><path d="M350.0 31h0.0">
</path><rect height=22 width=116 x=234.0 y=20>
</rect><text x=292.0 y=35>
decimal_byte</text></g><path d="M350.0 31h10">
</path><path d="M360.0 31h10">
</path><g>
<path d="M370.0 31h0.0">
</path><path d="M398.0 31h0.0">
</path><rect height=22 rx=10 ry=10 width=28 x=370.0 y=20>
</rect><text x=384.0 y=35>
.</text></g><path d="M398.0 31h10">
</path><path d="M408.0 31h10">
</path><g>
<path d="M418.0 31h0.0">
</path><path d="M534.0 31h0.0">
</path><rect height=22 width=116 x=418.0 y=20>
</rect><text x=476.0 y=35>
decimal_byte</text></g><path d="M534.0 31h10">
</path><path d="M544.0 31h10">
</path><g>
<path d="M554.0 31h0.0">
</path><path d="M582.0 31h0.0">
</path><rect height=22 rx=10 ry=10 width=28 x=554.0 y=20>
</rect><text x=568.0 y=35>
.</text></g><path d="M582.0 31h10">
</path><path d="M592.0 31h10">
</path><g>
<path d="M602.0 31h0.0">
</path><path d="M718.0 31h0.0">
</path><rect height=22 width=116 x=602.0 y=20>
</rect><text x=660.0 y=35>
decimal_byte</text></g><path d="M718.0 31h10">
</path></g><path d="M 728 31 h 20 m -10 -10 v 20 m 10 -20 v 20">
</path></g></svg></div>

<p>Return four decimal bytes separated by full stop characters as a string.</p>

<h3 class="heading settled" data-level=3.16 id=decimal_byte><span class=secno>3.16. </span><span class=content>decimal_byte</span><a class=self-link href=#decimal_byte></a></h3>

<div class=railroad><svg class=railroad-diagram height=72 viewBox="0 0 529 72" width=529>
<g transform="translate(.5 .5)">
<path d="M 20 31 v 20 m 10 -20 v 20 m -10 -10 h 20.5">
</path><g>
<path d="M40 41h0.0">
</path><path d="M488.0 41h0.0">
</path><g>
<path d="M40.0 41h0.0">
</path><path d="M196.0 41h0.0">
</path><path d="M40.0 41a10 10 0 0 0 10 -10v0a10 10 0 0 1 10 -10">
</path><g>
<path d="M60.0 21h116">
</path></g><path d="M176.0 21a10 10 0 0 1 10 10v0a10 10 0 0 0 10 10">
</path><path d="M40.0 41h20">
</path><g>
<path d="M60.0 41h0.0">
</path><path d="M176.0 41h0.0">
</path><rect height=22 rx=10 ry=10 width=116 x=60.0 y=30>
</rect><text x=118.0 y=45>
any of [0-2]</text></g><path d="M176.0 41h20">
</path></g><g>
<path d="M196.0 41h0.0">
</path><path d="M352.0 41h0.0">
</path><path d="M196.0 41a10 10 0 0 0 10 -10v0a10 10 0 0 1 10 -10">
</path><g>
<path d="M216.0 21h116">
</path></g><path d="M332.0 21a10 10 0 0 1 10 10v0a10 10 0 0 0 10 10">
</path><path d="M196.0 41h20">
</path><g>
<path d="M216.0 41h0.0">
</path><path d="M332.0 41h0.0">
</path><rect height=22 rx=10 ry=10 width=116 x=216.0 y=30>
</rect><text x=274.0 y=45>
any of [0-9]</text></g><path d="M332.0 41h20">
</path></g><path d="M352.0 41h10">
</path><g>
<path d="M362.0 41h0.0">
</path><path d="M478.0 41h0.0">
</path><rect height=22 rx=10 ry=10 width=116 x=362.0 y=30>
</rect><text x=420.0 y=45>
any of [0-9]</text></g><path d="M478.0 41h10">
</path></g><path d="M 488 41 h 20 m -10 -10 v 20 m 10 -20 v 20">
</path></g></svg></div>

<p>Decimal bytes are a string of up to three decimal digits.  If the results
converted to an integer are greater than 255, terminate processing with
a <a data-link-type=dfn href=#parse-errors title="parse error">parse error</a>.</p>

<h3 class="heading settled" data-level=3.17 id=port><span class=secno>3.17. </span><span class=content>port</span><a class=self-link href=#port></a></h3>

<div class=railroad><svg class=railroad-diagram height=81 viewBox="0 0 305 81" width=305>
<g transform="translate(.5 .5)">
<path d="M 20 31 v 20 m 10 -20 v 20 m -10 -10 h 20.5">
</path><g>
<path d="M40 41h0.0">
</path><path d="M264.0 41h0.0">
</path><path d="M40.0 41a10 10 0 0 0 10 -10v0a10 10 0 0 1 10 -10">
</path><g>
<path d="M60.0 21h184">
</path></g><path d="M244.0 21a10 10 0 0 1 10 10v0a10 10 0 0 0 10 10">
</path><path d="M40.0 41h20">
</path><g>
<path d="M60.0 41h0.0">
</path><path d="M244.0 41h0.0">
</path><path d="M60.0 41h10">
</path><g>
<path d="M70.0 41h0.0">
</path><path d="M234.0 41h0.0">
</path><rect height=22 rx=10 ry=10 width=164 x=70.0 y=30>
</rect><text x=152.0 y=45>
any except [/\\?#]</text></g><path d="M234.0 41h10">
</path><path d="M70.0 41a10 10 0 0 0 -10 10v0a10 10 0 0 0 10 10">
</path><g>
<path d="M70.0 61h164">
</path></g><path d="M234.0 61a10 10 0 0 0 10 -10v0a10 10 0 0 0 -10 -10">
</path></g><path d="M244.0 41h20">
</path></g><path d="M 264 41 h 20 m -10 -10 v 20 m 10 -20 v 20">
</path></g></svg></div>

<p>Consume all characters until either
a solidus (<code>U+002F</code>),
a reverse solidus (<code>U+005C</code>),
a question mark (<code>U+003F</code>),
or the end of string is encountered.
<a data-link-type=dfn href=#cleanse title=cleanse>Cleanse</a> result using <var>null</var> as
the encode set.
Remove leading <code>U+0030</code> code points from result
until either the leading code point is not <code>U+0030</code> or result is
one code point. 
If any characters that remain are not decimal digits, terminate processing
with a <a data-link-type=dfn href=#parse-errors title="parse error">parse error</a>.
Otherwise, return the result as a string.</p>

<h3 class="heading settled" data-level=3.18 id=path><span class=secno>3.18. </span><span class=content>path</span><a class=self-link href=#path></a></h3>

<div class=railroad><svg class=railroad-diagram height=99 viewBox="0 0 725 99" width=725>
<g transform="translate(.5 .5)">
<path d="M 20 41 v 20 m 10 -20 v 20 m -10 -10 h 20.5">
</path><g>
<path d="M40 51h0.0">
</path><path d="M684.0 51h0.0">
</path><g>
<path d="M40.0 51h0.0">
</path><path d="M460.0 51h0.0">
</path><path d="M40.0 51a10 10 0 0 0 10 -10v-9a10 10 0 0 1 10 -10">
</path><g>
<path d="M60.0 22h380">
</path></g><path d="M440.0 22a10 10 0 0 1 10 10v9a10 10 0 0 0 10 10">
</path><path d="M40.0 51h20">
</path><g>
<path d="M60.0 51h0.0">
</path><path d="M440.0 51h0.0">
</path><path d="M60.0 51h10">
</path><g>
<path d="M70.0 51h0.0">
</path><path d="M430.0 51h0.0">
</path><g>
<path d="M70.0 51h0.0">
</path><path d="M294.0 51h0.0">
</path><path d="M70.0 51a10 10 0 0 0 10 -10v0a10 10 0 0 1 10 -10">
</path><g>
<path d="M90.0 31h184">
</path></g><path d="M274.0 31a10 10 0 0 1 10 10v0a10 10 0 0 0 10 10">
</path><path d="M70.0 51h20">
</path><g>
<path d="M90.0 51h0.0">
</path><path d="M274.0 51h0.0">
</path><path d="M90.0 51h10">
</path><g>
<path d="M100.0 51h0.0">
</path><path d="M264.0 51h0.0">
</path><rect height=22 rx=10 ry=10 width=164 x=100.0 y=40>
</rect><text x=182.0 y=55>
any except [/\\?#]</text></g><path d="M264.0 51h10">
</path><path d="M100.0 51a10 10 0 0 0 -10 10v0a10 10 0 0 0 10 10">
</path><g>
<path d="M100.0 71h164">
</path></g><path d="M264.0 71a10 10 0 0 0 10 -10v0a10 10 0 0 0 -10 -10">
</path></g><path d="M274.0 51h20">
</path></g><path d="M294.0 51h10">
</path><g>
<path d="M304.0 51h0.0">
</path><path d="M420.0 51h0.0">
</path><rect height=22 rx=10 ry=10 width=116 x=304.0 y=40>
</rect><text x=362.0 y=55>
any of [/\\]</text></g><path d="M420.0 51h10">
</path></g><path d="M430.0 51h10">
</path><path d="M70.0 51a10 10 0 0 0 -10 10v8a10 10 0 0 0 10 10">
</path><g>
<path d="M70.0 79h360">
</path></g><path d="M430.0 79a10 10 0 0 0 10 -10v-8a10 10 0 0 0 -10 -10">
</path></g><path d="M440.0 51h20">
</path></g><g>
<path d="M460.0 51h0.0">
</path><path d="M684.0 51h0.0">
</path><path d="M460.0 51a10 10 0 0 0 10 -10v0a10 10 0 0 1 10 -10">
</path><g>
<path d="M480.0 31h184">
</path></g><path d="M664.0 31a10 10 0 0 1 10 10v0a10 10 0 0 0 10 10">
</path><path d="M460.0 51h20">
</path><g>
<path d="M480.0 51h0.0">
</path><path d="M664.0 51h0.0">
</path><path d="M480.0 51h10">
</path><g>
<path d="M490.0 51h0.0">
</path><path d="M654.0 51h0.0">
</path><rect height=22 rx=10 ry=10 width=164 x=490.0 y=40>
</rect><text x=572.0 y=55>
any except [/\\?#]</text></g><path d="M654.0 51h10">
</path><path d="M490.0 51a10 10 0 0 0 -10 10v0a10 10 0 0 0 10 10">
</path><g>
<path d="M490.0 71h164">
</path></g><path d="M654.0 71a10 10 0 0 0 10 -10v0a10 10 0 0 0 -10 -10">
</path></g><path d="M664.0 51h20">
</path></g></g><path d="M 684 51 h 20 m -10 -10 v 20 m 10 -20 v 20">
</path></g></svg></div>

<p>If any of the path separators are a reverse solidus ("<code>\</code>"), indicate
a <a data-link-type=dfn href=#parse-errors title="parse error">parse error</a>.</p>

<p>Extract all the pathnames into an array.  Process each name as follows:</p>

<ul><li data-md=""><p><a data-link-type=dfn href=#cleanse title=cleanse>Cleanse</a> the name using the
<a href="<code>https://url.spec.whatwg.org/#default-encode-set</code>">default encode
set</a> as the encode set.</p>
<li data-md=""><p>If the name is "<code>.</code>" or "<code>%2e</code>" (case insensitive),
then process this name based on the position in the array:</p>
<ul><li data-md=""><p>If the position is other than the last, remove the name from the list.</p>
<li data-md=""><p>If the array is of length 1, replace the entry with an empty string.</p>
<li data-md=""><p>Otherwise, leave the entry as is.</p>
</ul><li data-md=""><p>If the name is "<code>..</code>", "<code>.%2e</code>", "<code>%2e.</code>",
or "<code>%2e%2e</code>" (all to be compared in a case insensitive manner),
then process this name based on the position in the array:</p>
<ul><li data-md=""><p>If the position is the first, then remove it.</p>
<li data-md=""><p>If the position is other than the last, then remove it and the
  one before it.</p>
<li data-md=""><p>If the position is the last, then remove it and the one before it,
  then append an empty string.</p>
</ul></ul>
<p>Return the array.</p>

<h3 class="heading settled" data-level=3.19 id=data><span class=secno>3.19. </span><span class=content>data</span><a class=self-link href=#data></a></h3>

<div class=railroad><svg class=railroad-diagram height=81 viewBox="0 0 281 81" width=281>
<g transform="translate(.5 .5)">
<path d="M 20 31 v 20 m 10 -20 v 20 m -10 -10 h 20.5">
</path><g>
<path d="M40 41h0.0">
</path><path d="M240.0 41h0.0">
</path><path d="M40.0 41a10 10 0 0 0 10 -10v0a10 10 0 0 1 10 -10">
</path><g>
<path d="M60.0 21h160">
</path></g><path d="M220.0 21a10 10 0 0 1 10 10v0a10 10 0 0 0 10 10">
</path><path d="M40.0 41h20">
</path><g>
<path d="M60.0 41h0.0">
</path><path d="M220.0 41h0.0">
</path><path d="M60.0 41h10">
</path><g>
<path d="M70.0 41h0.0">
</path><path d="M210.0 41h0.0">
</path><rect height=22 rx=10 ry=10 width=140 x=70.0 y=30>
</rect><text x=140.0 y=45>
any except [?#]</text></g><path d="M210.0 41h10">
</path><path d="M70.0 41a10 10 0 0 0 -10 10v0a10 10 0 0 0 10 10">
</path><g>
<path d="M70.0 61h140">
</path></g><path d="M210.0 61a10 10 0 0 0 10 -10v0a10 10 0 0 0 -10 -10">
</path></g><path d="M220.0 41h20">
</path></g><path d="M 240 41 h 20 m -10 -10 v 20 m 10 -20 v 20">
</path></g></svg></div>

<p>Consume all characters until either a question mark (<code>U+003F</code>), a
number sign (<code>U+0023</code>), or the end of string is encountered.
Return the <a data-link-type=dfn href=#cleanse title=cleanse>cleansed</a> result using <var>null</var> as
the encode set.</p>

<h3 class="heading settled" data-level=3.20 id=query><span class=secno>3.20. </span><span class=content>query</span><a class=self-link href=#query></a></h3>

<div class=railroad><svg class=railroad-diagram height=81 viewBox="0 0 273 81" width=273>
<g transform="translate(.5 .5)">
<path d="M 20 31 v 20 m 10 -20 v 20 m -10 -10 h 20.5">
</path><g>
<path d="M40 41h0.0">
</path><path d="M232.0 41h0.0">
</path><path d="M40.0 41a10 10 0 0 0 10 -10v0a10 10 0 0 1 10 -10">
</path><g>
<path d="M60.0 21h152">
</path></g><path d="M212.0 21a10 10 0 0 1 10 10v0a10 10 0 0 0 10 10">
</path><path d="M40.0 41h20">
</path><g>
<path d="M60.0 41h0.0">
</path><path d="M212.0 41h0.0">
</path><path d="M60.0 41h10">
</path><g>
<path d="M70.0 41h0.0">
</path><path d="M202.0 41h0.0">
</path><rect height=22 rx=10 ry=10 width=132 x=70.0 y=30>
</rect><text x=136.0 y=45>
any except [#]</text></g><path d="M202.0 41h10">
</path><path d="M70.0 41a10 10 0 0 0 -10 10v0a10 10 0 0 0 10 10">
</path><g>
<path d="M70.0 61h132">
</path></g><path d="M202.0 61a10 10 0 0 0 10 -10v0a10 10 0 0 0 -10 -10">
</path></g><path d="M212.0 41h20">
</path></g><path d="M 232 41 h 20 m -10 -10 v 20 m 10 -20 v 20">
</path></g></svg></div>

<p>Consume all characters until either a
number sign (<code>U+0023</code>) or the end of string is encountered.
Return the <a data-link-type=dfn href=#cleanse title=cleanse>cleansed</a> result using the
the result using the <a data-link-type=dfn href=#query-encode-set title="query encode set">query encode set</a>.</p>

<p>The <dfn data-dfn-type=dfn data-noexport="" id=query-encode-set>query encode set<a class=self-link href=#query-encode-set></a></dfn> is defined to be bytes that are less than
<code>0x21</code>, greater than <code>0x7E</code>, or one of <code>0x22</code>, <code>0x23</code>, <code>0x3C</code>, <code>0x3E</code>, and <code>0x60</code>.</p>

<p class=note>Note: encoding override logic needs to be added.</p>

<h3 class="heading settled" data-level=3.21 id=fragment><span class=secno>3.21. </span><span class=content>fragment</span><a class=self-link href=#fragment></a></h3>

<div class=railroad><svg class=railroad-diagram height=81 viewBox="0 0 185 81" width=185>
<g transform="translate(.5 .5)">
<path d="M 20 31 v 20 m 10 -20 v 20 m -10 -10 h 20.5">
</path><g>
<path d="M40 41h0.0">
</path><path d="M144.0 41h0.0">
</path><path d="M40.0 41a10 10 0 0 0 10 -10v0a10 10 0 0 1 10 -10">
</path><g>
<path d="M60.0 21h64">
</path></g><path d="M124.0 21a10 10 0 0 1 10 10v0a10 10 0 0 0 10 10">
</path><path d="M40.0 41h20">
</path><g>
<path d="M60.0 41h0.0">
</path><path d="M124.0 41h0.0">
</path><path d="M60.0 41h10">
</path><g>
<path d="M70.0 41h0.0">
</path><path d="M114.0 41h0.0">
</path><rect height=22 rx=10 ry=10 width=44 x=70.0 y=30>
</rect><text x=92.0 y=45>
any</text></g><path d="M114.0 41h10">
</path><path d="M70.0 41a10 10 0 0 0 -10 10v0a10 10 0 0 0 10 10">
</path><g>
<path d="M70.0 61h44">
</path></g><path d="M114.0 61a10 10 0 0 0 10 -10v0a10 10 0 0 0 -10 -10">
</path></g><path d="M124.0 41h20">
</path></g><path d="M 144 41 h 20 m -10 -10 v 20 m 10 -20 v 20">
</path></g></svg></div>

<p>Consume all remaining characters in the input.
Return the <a data-link-type=dfn href=#cleanse title=cleanse>cleansed</a> result using the
<a href="<code>https://url.spec.whatwg.org/#default-encode-set</code>">simple encode
 set</a>.</p>

<h2 class="heading settled" data-level=4 id=common-functions><span class=secno>4. </span><span class=content>Common Functions</span><a class=self-link href=#common-functions></a></h2>

<p>To <dfn data-dfn-type=dfn data-noexport="" id=cleanse>cleanse<a class=self-link href=#cleanse></a></dfn> a string given an <var>encode set</var>, run these steps:</p>

<ul><li data-md=""><p>If any character in the string not a
 <a href=https://url.spec.whatwg.org/#url-code-points>URL code point</a>
 or a percent sign (<code>U+0025</code>), indicate a <a data-link-type=dfn href=#parse-errors title="parse error">parse error</a>.</p>

<li data-md=""><p>If the name includes a percent sign (<code>U+0025</code>) that is not
 immediately followed by two hexadecimal characters, indicate a <a data-link-type=dfn href=#parse-errors title="parse error">parse
 error</a>.</p>

<li data-md=""><p>If any <code>U+0009</code>, <code>U+000A</code> or <code>U+000D</code>
 characters are present in the string, remove those characters and indicate
 a <a data-link-type=dfn href=#parse-errors title="parse error">parse error</a>.</p>

<li data-md=""><p>if the <var>encode set</var> is non-null,
<a href=https://url.spec.whatwg.org/#percent-encode>Percent encode</a>
the result using the provided <var>encode set</var>.</p>

<li data-md=""><p>Return the result as a string.</p>
</ul>
<p>To do <dfn data-dfn-type=dfn data-noexport="" id=path-concatenation>path concatenation<a class=self-link href=#path-concatenation></a></dfn> given a <var>base</var> array of path
names, and a <var>path<path> array of names, perform the following steps:</path></var></p>

<ul><li data-md=""><p>If <var>base</var> is null, set <var>base</var> to an empty array.  Otherwise
 make a local copy of the <var>base</var> array.</p>

<li data-md=""><p>If the first element on <var>path</var> is ".", remove this first element
 from <var>path</var> as well as the last element (if any) of
 <var>base</var>.</p>

<li data-md=""><p>If <var>path.length</var> is one, and the first and only element on the
 <var>path</var> is an empty string, set <var>path</var> to the value of
 <var>base</var>.</p>

<li data-md=""><p>Otherwise if <var>path.length</var> is greater than one, and the first
 element on the <var>path</var> is the empty string, remove the first
 element from the <var>path</var>.</p>

<li data-md=""><p>Otherwise, remove the last element (if any) of <var>base</var> and then
 prepend the values of the <var>base</var> array to the <var>path</var>
 array.</p>
</ul>
<h2 class="no-num no-ref heading settled" id=conformance><span class=content>Conformance</span><a class=self-link href=#conformance></a></h2>

<p>All diagrams, examples, and notes in this specification are non-normative, as are all sections explicitly marked
non-normative. Everything else in this specification is normative.

<p>The key words "MUST", "MUST NOT", "REQUIRED",  "SHOULD", "SHOULD NOT", "RECOMMENDED",
"MAY", and "OPTIONAL" in the normative parts of this specification are to be interpreted as described in RFC2119. For
readability, these words do not appear in all uppercase letters in this specification. <a data-biblio-type=normative data-link-type=biblio href=#biblio-rfc2119 title=RFC2119>[RFC2119]</a>

<p>Conformance requirements phrased as algorithms or specific steps may be implemented in any manner, so long as the end
result is equivalent.
<h2 class="no-num heading settled" id=references><span class=content>References</span><a class=self-link href=#references></a></h2><h3 class="no-num heading settled" id=normative><span class=content>Normative References</span><a class=self-link href=#normative></a></h3><dl><dt id=biblio-encoding title=encoding><a class=self-link href=#biblio-encoding></a>[encoding]<dd>Anne van Kesteren; Joshua Bell; Addison Phillips. <a href=http://www.w3.org/TR/encoding/>Encoding</a>. 16 September 2014. CR. URL: <a href=http://www.w3.org/TR/encoding/>http://www.w3.org/TR/encoding/</a><dt id=biblio-rfc2119 title=rfc2119><a class=self-link href=#biblio-rfc2119></a>[rfc2119]<dd>S. Bradner. <a href=http://www.ietf.org/rfc/rfc2119.txt>Key words for use in RFCs to Indicate Requirement Levels</a>. March 1997. Best Current Practice. URL: <a href=http://www.ietf.org/rfc/rfc2119.txt>http://www.ietf.org/rfc/rfc2119.txt</a><dt id=biblio-rfc3492 title=rfc3492><a class=self-link href=#biblio-rfc3492></a>[rfc3492]<dd>A. Costello. <a href=http://www.ietf.org/rfc/rfc3492.txt>Punycode: A Bootstring encoding of Unicode for Internationalized Domain Names in Applications (IDNA)</a>. March 2003. Proposed Standard. URL: <a href=http://www.ietf.org/rfc/rfc3492.txt>http://www.ietf.org/rfc/rfc3492.txt</a></dl><h3 class="no-num heading settled" id=informative><span class=content>Informative References</span><a class=self-link href=#informative></a></h3><dl><dt id=biblio-rfc3986 title=rfc3986><a class=self-link href=#biblio-rfc3986></a>[rfc3986]<dd>T. Berners-Lee; R. Fielding; L. Masinter. <a href=http://www.ietf.org/rfc/rfc3986.txt>Uniform Resource Identifier (URI): Generic Syntax</a>. January 2005. Internet Standard. URL: <a href=http://www.ietf.org/rfc/rfc3986.txt>http://www.ietf.org/rfc/rfc3986.txt</a><dt id=biblio-rfc3987 title=rfc3987><a class=self-link href=#biblio-rfc3987></a>[rfc3987]<dd>M. Duerst; M. Suignard. <a href=http://www.ietf.org/rfc/rfc3987.txt>Internationalized Resource Identifiers (IRIs)</a>. January 2005. Proposed Standard. URL: <a href=http://www.ietf.org/rfc/rfc3987.txt>http://www.ietf.org/rfc/rfc3987.txt</a></dl><h2 class="no-num heading settled" id=index><span class=content>Index</span><a class=self-link href=#index></a></h2><ul class=indexlist><li>cleanse, <a href=#cleanse title="section 4">4</a><li>parse errors, <a href=#parse-errors title="section 3">3</a><li>path concatenation, <a href=#path-concatenation title="section 4">4</a><li>query encode set, <a href=#query-encode-set title="section 3.20">3.20</a></ul>